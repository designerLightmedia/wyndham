Neatline.module("Waypoints",function(a,b){a.ID="WAYPOINTS",a.addInitializer(function(){a.__collection=new b.Shared.Record.Collection,a.__view=new a.View,b.execute(a.ID+":load")})}),Neatline.module("Waypoints",function(a,b){var c=function(){var b={widget:"Waypoints",order:"weight"};a.__collection.update(b,function(a){d(a)})};b.commands.setHandler(a.ID+":load",c),b.vent.on("refresh",c);var d=function(b){a.__view.ingest(b)};b.commands.setHandler(a.ID+":ingest",d);var e=function(b){a.__view.renderHighlight(b.model)};b.commands.setHandler(a.ID+":highlight",e),b.vent.on("highlight",e);var f=function(b){a.__view.renderUnhighlight(b.model)};b.commands.setHandler(a.ID+":unhighlight",f),b.vent.on("unhighlight",f);var g=function(b){a.__view.renderSelect(b.model),a.__view.scrollTo(b.model),f(b)};b.commands.setHandler(a.ID+":select",g),b.vent.on("select",g);var h=function(b){a.__view.renderUnselect(b.model),f(b)};b.commands.setHandler(a.ID+":unselect",h),b.vent.on("unselect",h);var i=function(b){a.__view.setFilter(b.key,b.evaluator)};b.commands.setHandler(a.ID+":setFilter",i),b.vent.on("setFilter",i);var j=function(b){a.__view.removeFilter(b.key)};b.commands.setHandler(a.ID+":removeFilter",j),b.vent.on("removeFilter",j)}),Neatline.module("Waypoints",function(a,b,c,d,e,f){a.View=b.Shared.Widget.View.extend({id:"waypoints",events:{"mouseenter a":"publishHighlight","mouseleave a":"publishUnhighlight","click a":"publishSelect"},options:{duration:200},init:function(){this.template=f.template(e("#waypoints-public-list-template").html()),this.filters={},this.model=null},ingest:function(a){this.$el.toggleClass("empty",0==a.length),this.$el.html(this.template({records:a})),this.filter()},publishHighlight:function(a){this.publish("highlight",this.getModelByEvent(a))},publishUnhighlight:function(a){this.publish("unhighlight",this.getModelByEvent(a))},publishSelect:function(a){var b=this.getModelByEvent(a),c=this.model;c&&(this.publish("unselect",c),c.id==b.id)||this.publish("select",b)},renderHighlight:function(a){this.getElementById(a.id).addClass("highlighted")},renderUnhighlight:function(a){this.getElementById(a.id).removeClass("highlighted")},renderSelect:function(a){this.getElementById(a.id).addClass("selected"),this.model=a},renderUnselect:function(a){this.getElementById(a.id).removeClass("selected"),this.model=null},scrollTo:function(a){var b=this.getElementById(a.id)[0];b&&this.$el.animate({scrollTop:b.offsetTop},{duration:this.options.duration})},setFilter:function(a,b){this.filters[a]=b,this.filter()},removeFilter:function(a){delete this.filters[a],this.filter()},filter:function(){a.__collection.each(f.bind(function(a){var b=!0;f.each(this.filters,function(c){b=b&&c(a)}),this.getElementById(a.id).toggle(b)},this))},getModelByEvent:function(b){return a.__collection.get(parseInt(e(b.currentTarget).attr("data-id"),10))},getElementById:function(a){return this.$("a[data-id="+a+"]")},publish:function(c,d){b.vent.trigger(c,{source:a.ID,model:d})}})}),Neatline.module("Editor.Exhibit.Waypoints",function(a,b){a.ID="EDITOR:WAYPOINTS",a.addInitializer(function(){a.__collection=new b.Shared.Record.Collection,a.__router=new a.Router,a.__view=new a.View})}),Neatline.module("Editor.Exhibit.Waypoints",function(a,b){var c=function(b){a.__view.showIn(b);var c={widget:"waypoints",order:"weight"};a.__collection.update(c,function(b){a.__view.ingest(b)})};b.commands.setHandler(a.ID+":display",c)}),Neatline.module("Editor.Exhibit.Waypoints",function(a,b){a.Router=b.Editor.Router.extend({routes:{waypoints:"waypoints"},waypoints:function(){b.execute("EDITOR:display",["EDITOR:EXHIBIT","EDITOR:WAYPOINTS"]),b.execute("EDITOR:EXHIBIT:activateTab","waypoints")}})}),Neatline.module("Editor.Exhibit.Waypoints",function(a,b,c,d,e,f){a.View=c.Neatline.View.extend({template:"#waypoints-form-template",className:"form-stacked waypoints",tagName:"form",events:{'click a[name="save"]':"save"},ui:{save:'a[name="save"]',list:"div.sort"},init:function(){this.__ui.list.sortable(),this.template=f.template(e("#waypoints-editor-list-template").html())},ingest:function(a){this.__ui.list.html(this.template({records:a})),a.length>0?this.enableSorting():this.disableSorting(),this.records=a},save:function(){0!=this.records.length&&e.ajax({data:JSON.stringify(this.getOrder()),url:b.g.waypoints.order_api,success:f.bind(this.onSaveSuccess,this),error:f.bind(this.onSaveError,this),type:"POST"})},enableSorting:function(){this.__ui.list.sortable("enable"),this.__ui.save.removeClass("disabled")},disableSorting:function(){this.__ui.list.sortable("disable"),this.__ui.save.addClass("disabled")},getOrder:function(){return this.__ui.list.sortable("toArray",{attribute:"data-id"})},onSaveSuccess:function(){b.vent.trigger("refresh",{source:a.ID}),b.execute("EDITOR:notifySuccess",WP_STRINGS.order.save.success)},onSaveError:function(){b.execute("EDITOR:notifyError",WP_STRINGS.order.save.error)}})});