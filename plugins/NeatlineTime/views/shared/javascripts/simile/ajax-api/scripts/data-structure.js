SimileAjax.Set=function(a){this._hash={};this._count=0;if(a instanceof Array)for(var b=0;b<a.length;b++)this.add(a[b]);else a instanceof SimileAjax.Set&&this.addSet(a)};SimileAjax.Set.prototype.add=function(a){return!(a in this._hash)?(this._hash[a]=!0,this._count++,!0):!1};SimileAjax.Set.prototype.addSet=function(a){for(var b in a._hash)this.add(b)};SimileAjax.Set.prototype.remove=function(a){return a in this._hash?(delete this._hash[a],this._count--,!0):!1};SimileAjax.Set.prototype.removeSet=function(a){for(var b in a._hash)this.remove(b)};
SimileAjax.Set.prototype.retainSet=function(a){for(var b in this._hash)a.contains(b)||(delete this._hash[b],this._count--)};SimileAjax.Set.prototype.contains=function(a){return a in this._hash};SimileAjax.Set.prototype.size=function(){return this._count};SimileAjax.Set.prototype.toArray=function(){var a=[],b;for(b in this._hash)a.push(b);return a};SimileAjax.Set.prototype.visit=function(a){for(var b in this._hash)if(a(b)==!0)break};
SimileAjax.SortedArray=function(a,b){this._a=b instanceof Array?b:[];this._compare=a};SimileAjax.SortedArray.prototype.add=function(a){var b=this,c=this.find(function(c){return b._compare(c,a)});c<this._a.length?this._a.splice(c,0,a):this._a.push(a)};SimileAjax.SortedArray.prototype.remove=function(a){for(var b=this,c=this.find(function(c){return b._compare(c,a)});c<this._a.length&&this._compare(this._a[c],a)==0;)if(this._a[c]==a)return this._a.splice(c,1),!0;else c++;return!1};
SimileAjax.SortedArray.prototype.removeAll=function(){this._a=[]};SimileAjax.SortedArray.prototype.elementAt=function(a){return this._a[a]};SimileAjax.SortedArray.prototype.length=function(){return this._a.length};SimileAjax.SortedArray.prototype.find=function(a){for(var b=0,c=this._a.length;b<c;){var d=Math.floor((b+c)/2),e=a(this._a[d]);if(d==b)return e<0?b+1:b;else e<0?b=d:c=d}return b};SimileAjax.SortedArray.prototype.getFirst=function(){return this._a.length>0?this._a[0]:null};
SimileAjax.SortedArray.prototype.getLast=function(){return this._a.length>0?this._a[this._a.length-1]:null};SimileAjax.EventIndex=function(a){var b=this;this._unit=a!=null?a:SimileAjax.NativeDateUnit;this._events=new SimileAjax.SortedArray(function(a,d){return b._unit.compare(a.getStart(),d.getStart())});this._idToEvent={};this._indexed=!0};SimileAjax.EventIndex.prototype.getUnit=function(){return this._unit};SimileAjax.EventIndex.prototype.getEvent=function(a){return this._idToEvent[a]};
SimileAjax.EventIndex.prototype.add=function(a){this._events.add(a);this._idToEvent[a.getID()]=a;this._indexed=!1};SimileAjax.EventIndex.prototype.removeAll=function(){this._events.removeAll();this._idToEvent={};this._indexed=!1};SimileAjax.EventIndex.prototype.getCount=function(){return this._events.length()};SimileAjax.EventIndex.prototype.getIterator=function(a,b){this._indexed||this._index();return new SimileAjax.EventIndex._Iterator(this._events,a,b,this._unit)};
SimileAjax.EventIndex.prototype.getReverseIterator=function(a,b){this._indexed||this._index();return new SimileAjax.EventIndex._ReverseIterator(this._events,a,b,this._unit)};SimileAjax.EventIndex.prototype.getAllIterator=function(){return new SimileAjax.EventIndex._AllIterator(this._events)};SimileAjax.EventIndex.prototype.getEarliestDate=function(){var a=this._events.getFirst();return a==null?null:a.getStart()};
SimileAjax.EventIndex.prototype.getLatestDate=function(){var a=this._events.getLast();if(a==null)return null;this._indexed||this._index();var b=a._earliestOverlapIndex,a=this._events.elementAt(b).getEnd();for(b+=1;b<this._events.length();b++)a=this._unit.later(a,this._events.elementAt(b).getEnd());return a};
SimileAjax.EventIndex.prototype._index=function(){for(var a=this._events.length(),b=0;b<a;b++){var c=this._events.elementAt(b);c._earliestOverlapIndex=b}for(var d=1,b=0;b<a;b++){c=this._events.elementAt(b);c=c.getEnd();for(d=Math.max(d,b+1);d<a;){var e=this._events.elementAt(d);if(this._unit.compare(e.getStart(),c)<0)e._earliestOverlapIndex=b,d++;else break}}this._indexed=!0};
SimileAjax.EventIndex._Iterator=function(a,b,c,d){this._events=a;this._startDate=b;this._endDate=c;this._unit=d;this._currentIndex=a.find(function(a){return d.compare(a.getStart(),b)});if(this._currentIndex-1>=0)this._currentIndex=this._events.elementAt(this._currentIndex-1)._earliestOverlapIndex;this._currentIndex--;this._maxIndex=a.find(function(a){return d.compare(a.getStart(),c)});this._hasNext=!1;this._next=null;this._findNext()};
SimileAjax.EventIndex._Iterator.prototype={hasNext:function(){return this._hasNext},next:function(){if(this._hasNext){var a=this._next;this._findNext();return a}else return null},_findNext:function(){for(var a=this._unit;++this._currentIndex<this._maxIndex;){var b=this._events.elementAt(this._currentIndex);if(a.compare(b.getStart(),this._endDate)<0&&a.compare(b.getEnd(),this._startDate)>0){this._next=b;this._hasNext=!0;return}}this._next=null;this._hasNext=!1}};
SimileAjax.EventIndex._ReverseIterator=function(a,b,c,d){this._events=a;this._startDate=b;this._endDate=c;this._unit=d;this._minIndex=a.find(function(a){return d.compare(a.getStart(),b)});if(this._minIndex-1>=0)this._minIndex=this._events.elementAt(this._minIndex-1)._earliestOverlapIndex;this._currentIndex=this._maxIndex=a.find(function(a){return d.compare(a.getStart(),c)});this._hasNext=!1;this._next=null;this._findNext()};
SimileAjax.EventIndex._ReverseIterator.prototype={hasNext:function(){return this._hasNext},next:function(){if(this._hasNext){var a=this._next;this._findNext();return a}else return null},_findNext:function(){for(var a=this._unit;--this._currentIndex>=this._minIndex;){var b=this._events.elementAt(this._currentIndex);if(a.compare(b.getStart(),this._endDate)<0&&a.compare(b.getEnd(),this._startDate)>0){this._next=b;this._hasNext=!0;return}}this._next=null;this._hasNext=!1}};
SimileAjax.EventIndex._AllIterator=function(a){this._events=a;this._index=0};SimileAjax.EventIndex._AllIterator.prototype={hasNext:function(){return this._index<this._events.length()},next:function(){return this._index<this._events.length()?this._events.elementAt(this._index++):null}};
