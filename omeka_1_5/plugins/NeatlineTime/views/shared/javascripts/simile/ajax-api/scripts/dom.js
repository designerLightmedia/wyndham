SimileAjax.DOM={};SimileAjax.DOM.registerEventWithObject=function(a,b,c,d){SimileAjax.DOM.registerEvent(a,b,function(a,b,g){return c[d].call(c,a,b,g)})};SimileAjax.DOM.registerEvent=function(a,b,c){var d=function(b){if(b=b?b:event?event:null){var d=b.target?b.target:b.srcElement?b.srcElement:null;d&&(d=d.nodeType==1||d.nodeType==9?d:d.parentNode);return c(a,b,d)}return!0};SimileAjax.Platform.browser.isIE?a.attachEvent("on"+b,d):a.addEventListener(b,d,!1)};
SimileAjax.DOM.getPageCoordinates=function(a){var b=0,c=0;if(a.nodeType!=1)a=a.parentNode;for(var d=a;d!=null;)b+=d.offsetLeft,c+=d.offsetTop,d=d.offsetParent;for(d=document.body;a!=null&&a!=d;)"scrollLeft"in a&&(b-=a.scrollLeft,c-=a.scrollTop),a=a.parentNode;return{left:b,top:c}};SimileAjax.DOM.getSize=function(a){var b=this.getStyle(a,"width"),a=this.getStyle(a,"height");b.indexOf("px")>-1&&(b=b.replace("px",""));a.indexOf("px")>-1&&(a=a.replace("px",""));return{w:b,h:a}};
SimileAjax.DOM.getStyle=function(a,b){return a.currentStyle?a.currentStyle[b]:window.getComputedStyle?document.defaultView.getComputedStyle(a,null).getPropertyValue(b):""};
SimileAjax.DOM.getEventRelativeCoordinates=function(a,b){if(SimileAjax.Platform.browser.isIE)if(a.type=="mousewheel"){var c=SimileAjax.DOM.getPageCoordinates(b);return{x:a.clientX-c.left,y:a.clientY-c.top}}else return{x:a.offsetX,y:a.offsetY};else return c=SimileAjax.DOM.getPageCoordinates(b),a.type=="DOMMouseScroll"&&SimileAjax.Platform.browser.isFirefox&&SimileAjax.Platform.browser.majorVersion==2?{x:a.screenX-c.left,y:a.screenY-c.top}:{x:a.pageX-c.left,y:a.pageY-c.top}};
SimileAjax.DOM.getEventPageCoordinates=function(a){return SimileAjax.Platform.browser.isIE?{x:a.clientX+document.body.scrollLeft,y:a.clientY+document.body.scrollTop}:{x:a.pageX,y:a.pageY}};SimileAjax.DOM.hittest=function(a,b,c){return SimileAjax.DOM._hittest(document.body,a,b,c)};
SimileAjax.DOM._hittest=function(a,b,c,d){var e=a.childNodes,f=0;a:for(;f<e.length;f++){for(var g=e[f],h=0;h<d.length;h++)if(g==d[h])continue a;if(g.offsetWidth==0&&g.offsetHeight==0){if(h=SimileAjax.DOM._hittest(g,b,c,d),h!=g)return h}else{for(var j=h=0,i=g;i;)h+=i.offsetTop,j+=i.offsetLeft,i=i.offsetParent;if(j<=b&&h<=c&&b-j<g.offsetWidth&&c-h<g.offsetHeight)return SimileAjax.DOM._hittest(g,b,c,d);else if(g.nodeType==1&&g.tagName=="TR"&&(h=SimileAjax.DOM._hittest(g,b,c,d),h!=g))return h}}return a};
SimileAjax.DOM.cancelEvent=function(a){a.returnValue=!1;a.cancelBubble=!0;"preventDefault"in a&&a.preventDefault()};SimileAjax.DOM.appendClassName=function(a,b){for(var c=a.className.split(" "),d=0;d<c.length;d++)if(c[d]==b)return;c.push(b);a.className=c.join(" ")};SimileAjax.DOM.createInputElement=function(a){var b=document.createElement("div");b.innerHTML="<input type='"+a+"' />";return b.firstChild};
SimileAjax.DOM.createDOMFromTemplate=function(a){var b={};b.elmt=SimileAjax.DOM._createDOMFromTemplate(a,b,null);return b};
SimileAjax.DOM._createDOMFromTemplate=function(a,b,c){if(a==null)return null;else if(typeof a!="object")return a=document.createTextNode(a),c!=null&&c.appendChild(a),a;else{var d=null;if("tag"in a){var e=a.tag;c!=null&&(e=="tr"?d=c.insertRow(c.rows.length):e=="td"&&(d=c.insertCell(c.cells.length)));d==null&&(d=e=="input"?SimileAjax.DOM.createInputElement(a.type):document.createElement(e),c!=null&&c.appendChild(d))}else d=a.elmt,c!=null&&c.appendChild(d);for(var f in a)if(c=a[f],f=="field")b[c]=d;
else if(f=="className")d.className=c;else if(f=="id")d.id=c;else if(f=="title")d.title=c;else if(!(f=="type"&&d.tagName=="input"))if(f=="style")for(n in c)e=c[n],n=="float"&&(n=SimileAjax.Platform.browser.isIE?"styleFloat":"cssFloat"),d.style[n]=e;else if(f=="children")for(e=0;e<c.length;e++)SimileAjax.DOM._createDOMFromTemplate(c[e],b,d);else f!="tag"&&f!="elmt"&&d.setAttribute(f,c);return d}};SimileAjax.DOM._cachedParent=null;
SimileAjax.DOM.createElementFromString=function(a){if(SimileAjax.DOM._cachedParent==null)SimileAjax.DOM._cachedParent=document.createElement("div");SimileAjax.DOM._cachedParent.innerHTML=a;return SimileAjax.DOM._cachedParent.firstChild};SimileAjax.DOM.createDOMFromString=function(a,b,c){a=typeof a=="string"?document.createElement(a):a;a.innerHTML=b;b={elmt:a};SimileAjax.DOM._processDOMChildrenConstructedFromString(b,a,c!=null?c:{});return b};
SimileAjax.DOM._processDOMConstructedFromString=function(a,b,c){var d=b.id;if(d!=null&&d.length>0)if(b.removeAttribute("id"),d in c){var e=b.parentNode;e.insertBefore(c[d],b);e.removeChild(b);a[d]=c[d];return}else a[d]=b;b.hasChildNodes()&&SimileAjax.DOM._processDOMChildrenConstructedFromString(a,b,c)};SimileAjax.DOM._processDOMChildrenConstructedFromString=function(a,b,c){for(b=b.firstChild;b!=null;){var d=b.nextSibling;b.nodeType==1&&SimileAjax.DOM._processDOMConstructedFromString(a,b,c);b=d}};
