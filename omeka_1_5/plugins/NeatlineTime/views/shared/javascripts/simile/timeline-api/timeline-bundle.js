Timeline._Band=function(a,b,c){if(a.autoWidth&&typeof b.width=="string")b.width=b.width.indexOf("%")>-1?0:parseInt(b.width);this._timeline=a;this._bandInfo=b;this._index=c;this._locale="locale"in b?b.locale:Timeline.getDefaultLocale();this._timeZone="timeZone"in b?b.timeZone:0;this._labeller="labeller"in b?b.labeller:"createLabeller"in a.getUnit()?a.getUnit().createLabeller(this._locale,this._timeZone):new Timeline.GregorianDateLabeller(this._locale,this._timeZone);this._theme=b.theme;this._zoomIndex=
"zoomIndex"in b?b.zoomIndex:0;this._zoomSteps="zoomSteps"in b?b.zoomSteps:null;this._changing=this._dragging=!1;this._scrollSpeed=this._originalScrollSpeed=5;this._onScrollListeners=[];var d=this;this._syncWithBand=null;this._syncWithBandHandler=function(){d._onHighlightBandScroll()};this._selectorListener=function(){d._onHighlightBandScroll()};var f=this._timeline.getDocument().createElement("div");f.className="timeline-band-input";this._timeline.addDiv(f);this._keyboardInput=document.createElement("input");
this._keyboardInput.type="text";f.appendChild(this._keyboardInput);SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keydown",this,"_onKeyDown");SimileAjax.DOM.registerEventWithObject(this._keyboardInput,"keyup",this,"_onKeyUp");this._div=this._timeline.getDocument().createElement("div");this._div.id="timeline-band-"+c;this._div.className="timeline-band timeline-band-"+c;this._timeline.addDiv(this._div);SimileAjax.DOM.registerEventWithObject(this._div,"mousedown",this,"_onMouseDown");SimileAjax.DOM.registerEventWithObject(this._div,
"mousemove",this,"_onMouseMove");SimileAjax.DOM.registerEventWithObject(this._div,"mouseup",this,"_onMouseUp");SimileAjax.DOM.registerEventWithObject(this._div,"mouseout",this,"_onMouseOut");SimileAjax.DOM.registerEventWithObject(this._div,"dblclick",this,"_onDblClick");c=this._theme!=null?this._theme.mouseWheel:"scroll";if(c==="zoom"||c==="scroll"||this._zoomSteps)SimileAjax.Platform.browser.isFirefox?SimileAjax.DOM.registerEventWithObject(this._div,"DOMMouseScroll",this,"_onMouseScroll"):SimileAjax.DOM.registerEventWithObject(this._div,
"mousewheel",this,"_onMouseScroll");this._innerDiv=this._timeline.getDocument().createElement("div");this._innerDiv.className="timeline-band-inner";this._div.appendChild(this._innerDiv);this._ether=b.ether;b.ether.initialize(this,a);this._etherPainter=b.etherPainter;b.etherPainter.initialize(this,a);if(this._eventSource=b.eventSource)this._eventListener={onAddMany:function(){d._onAddMany()},onClear:function(){d._onClear()}},this._eventSource.addListener(this._eventListener);this._eventPainter=b.eventPainter;
this._eventTrackIncrement=this._eventTracksNeeded=0;b.eventPainter.initialize(this,a);this._decorators="decorators"in b?b.decorators:[];for(b=0;b<this._decorators.length;b++)this._decorators[b].initialize(this,a)};Timeline._Band.SCROLL_MULTIPLES=5;
Timeline._Band.prototype.dispose=function(){this.closeBubble();if(this._eventSource)this._eventSource.removeListener(this._eventListener),this._eventSource=this._eventListener=null;this._keyboardInput=this._innerDiv=this._div=this._selectorListener=this._syncWithBandHandler=this._onScrollListeners=this._decorators=this._eventPainter=this._etherPainter=this._ether=this._labeller=this._bandInfo=this._timeline=null};Timeline._Band.prototype.addOnScrollListener=function(a){this._onScrollListeners.push(a)};
Timeline._Band.prototype.removeOnScrollListener=function(a){for(var b=0;b<this._onScrollListeners.length;b++)if(this._onScrollListeners[b]==a){this._onScrollListeners.splice(b,1);break}};Timeline._Band.prototype.setSyncWithBand=function(a,b){this._syncWithBand&&this._syncWithBand.removeOnScrollListener(this._syncWithBandHandler);this._syncWithBand=a;this._syncWithBand.addOnScrollListener(this._syncWithBandHandler);this._highlight=b;this._positionHighlight()};Timeline._Band.prototype.getLocale=function(){return this._locale};
Timeline._Band.prototype.getTimeZone=function(){return this._timeZone};Timeline._Band.prototype.getLabeller=function(){return this._labeller};Timeline._Band.prototype.getIndex=function(){return this._index};Timeline._Band.prototype.getEther=function(){return this._ether};Timeline._Band.prototype.getEtherPainter=function(){return this._etherPainter};Timeline._Band.prototype.getEventSource=function(){return this._eventSource};Timeline._Band.prototype.getEventPainter=function(){return this._eventPainter};
Timeline._Band.prototype.getTimeline=function(){return this._timeline};Timeline._Band.prototype.updateEventTrackInfo=function(a,b){this._eventTrackIncrement=b;if(a>this._eventTracksNeeded)this._eventTracksNeeded=a};
Timeline._Band.prototype.checkAutoWidth=function(){if(this._timeline.autoWidth){var a=this._eventPainter.getType()=="overview",b=Math.ceil((this._eventTracksNeeded+(a?this._theme.event.overviewTrack.autoWidthMargin:this._theme.event.track.autoWidthMargin))*this._eventTrackIncrement);b+=a?this._theme.event.overviewTrack.offset:this._theme.event.track.offset;a=this._bandInfo;if(b!=a.width)a.width=b}};Timeline._Band.prototype.layout=function(){this.paint()};
Timeline._Band.prototype.paint=function(){this._etherPainter.paint();this._paintDecorators();this._paintEvents()};Timeline._Band.prototype.softLayout=function(){this.softPaint()};Timeline._Band.prototype.softPaint=function(){this._etherPainter.softPaint();this._softPaintDecorators();this._softPaintEvents()};
Timeline._Band.prototype.setBandShiftAndWidth=function(a,b){var c=this._keyboardInput.parentNode,d=a+Math.floor(b/2);this._timeline.isHorizontal()?(this._div.style.top=a+"px",this._div.style.height=b+"px",c.style.top=d+"px",c.style.left="-1em"):(this._div.style.left=a+"px",this._div.style.width=b+"px",c.style.left=d+"px",c.style.top="-1em")};Timeline._Band.prototype.getViewWidth=function(){return this._timeline.isHorizontal()?this._div.offsetHeight:this._div.offsetWidth};
Timeline._Band.prototype.setViewLength=function(a){this._viewLength=a;this._recenterDiv();this._onChanging()};Timeline._Band.prototype.getViewLength=function(){return this._viewLength};Timeline._Band.prototype.getTotalViewLength=function(){return Timeline._Band.SCROLL_MULTIPLES*this._viewLength};Timeline._Band.prototype.getViewOffset=function(){return this._viewOffset};Timeline._Band.prototype.getMinDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset)};
Timeline._Band.prototype.getMaxDate=function(){return this._ether.pixelOffsetToDate(this._viewOffset+Timeline._Band.SCROLL_MULTIPLES*this._viewLength)};Timeline._Band.prototype.getMinVisibleDate=function(){return this._ether.pixelOffsetToDate(0)};Timeline._Band.prototype.getMinVisibleDateAfterDelta=function(a){return this._ether.pixelOffsetToDate(a)};Timeline._Band.prototype.getMaxVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength)};
Timeline._Band.prototype.getMaxVisibleDateAfterDelta=function(a){return this._ether.pixelOffsetToDate(this._viewLength+a)};Timeline._Band.prototype.getCenterVisibleDate=function(){return this._ether.pixelOffsetToDate(this._viewLength/2)};Timeline._Band.prototype.setMinVisibleDate=function(a){this._changing||this._moveEther(Math.round(-this._ether.dateToPixelOffset(a)))};Timeline._Band.prototype.setMaxVisibleDate=function(a){this._changing||this._moveEther(Math.round(this._viewLength-this._ether.dateToPixelOffset(a)))};
Timeline._Band.prototype.setCenterVisibleDate=function(a){this._changing||this._moveEther(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(a)))};Timeline._Band.prototype.dateToPixelOffset=function(a){return this._ether.dateToPixelOffset(a)-this._viewOffset};Timeline._Band.prototype.pixelOffsetToDate=function(a){return this._ether.pixelOffsetToDate(a+this._viewOffset)};
Timeline._Band.prototype.createLayerDiv=function(a,b){var c=this._timeline.getDocument().createElement("div");c.className="timeline-band-layer"+(typeof b=="string"?" "+b:"");c.style.zIndex=a;this._innerDiv.appendChild(c);var d=this._timeline.getDocument().createElement("div");d.className="timeline-band-layer-inner";d.style.cursor=SimileAjax.Platform.browser.isIE?"move":"-moz-grab";c.appendChild(d);return d};Timeline._Band.prototype.removeLayerDiv=function(a){this._innerDiv.removeChild(a.parentNode)};
Timeline._Band.prototype.scrollToCenter=function(a,b){var c=this._ether.dateToPixelOffset(a);c<-this._viewLength/2?this.setCenterVisibleDate(this.pixelOffsetToDate(c+this._viewLength)):c>3*this._viewLength/2&&this.setCenterVisibleDate(this.pixelOffsetToDate(c-this._viewLength));this._autoScroll(Math.round(this._viewLength/2-this._ether.dateToPixelOffset(a)),b)};
Timeline._Band.prototype.showBubbleForEvent=function(a){var b=this.getEventSource().getEvent(a);if(b){var c=this;this.scrollToCenter(b.getStart(),function(){c._eventPainter.showBubble(b)})}};Timeline._Band.prototype.zoom=function(a,b){if(this._zoomSteps){b+=this._viewOffset;var c=this._ether.pixelOffsetToDate(b);this._etherPainter.zoom(this._ether.zoom(a));this._moveEther(Math.round(-this._ether.dateToPixelOffset(c)));this._moveEther(b)}};
Timeline._Band.prototype._onMouseDown=function(a,b){this.closeBubble();this._dragging=!0;this._dragX=b.clientX;this._dragY=b.clientY};Timeline._Band.prototype._onMouseMove=function(a,b){if(this._dragging){var c=b.clientX-this._dragX,d=b.clientY-this._dragY;this._dragX=b.clientX;this._dragY=b.clientY;this._moveEther(this._timeline.isHorizontal()?c:d);this._positionHighlight()}};Timeline._Band.prototype._onMouseUp=function(){this._dragging=!1;this._keyboardInput.focus()};
Timeline._Band.prototype._onMouseOut=function(a,b){var c=SimileAjax.DOM.getEventRelativeCoordinates(b,a);c.x+=this._viewOffset;if(c.x<0||c.x>a.offsetWidth||c.y<0||c.y>a.offsetHeight)this._dragging=!1};
Timeline._Band.prototype._onMouseScroll=function(a,b){var c=new Date,c=c.getTime();if(!this._lastScrollTime||c-this._lastScrollTime>50){this._lastScrollTime=c;c=0;b.wheelDelta?c=b.wheelDelta/120:b.detail&&(c=-b.detail/3);var d=this._theme.mouseWheel;if(this._zoomSteps||d==="zoom"){if(d=SimileAjax.DOM.getEventRelativeCoordinates(b,a),c!=0){var f;c>0&&(f=!0);c<0&&(f=!1);this._timeline.zoom(f,d.x,d.y,a)}}else d==="scroll"&&this._moveEther(50*(c<0?-1:1))}b.stopPropagation&&b.stopPropagation();b.cancelBubble=
!0;b.preventDefault&&b.preventDefault();b.returnValue=!1};Timeline._Band.prototype._onDblClick=function(a,b){this._autoScroll(-(SimileAjax.DOM.getEventRelativeCoordinates(b,a).x-(this._viewLength/2-this._viewOffset)))};
Timeline._Band.prototype._onKeyDown=function(a,b){if(!this._dragging){switch(b.keyCode){case 27:break;case 37:case 38:this._scrollSpeed=Math.min(50,Math.abs(this._scrollSpeed*1.05));this._moveEther(this._scrollSpeed);break;case 39:case 40:this._scrollSpeed=-Math.min(50,Math.abs(this._scrollSpeed*1.05));this._moveEther(this._scrollSpeed);break;default:return!0}this.closeBubble();SimileAjax.DOM.cancelEvent(b);return!1}return!0};
Timeline._Band.prototype._onKeyUp=function(a,b){if(!this._dragging){this._scrollSpeed=this._originalScrollSpeed;switch(b.keyCode){case 35:this.setCenterVisibleDate(this._eventSource.getLatestDate());break;case 36:this.setCenterVisibleDate(this._eventSource.getEarliestDate());break;case 33:this._autoScroll(this._timeline.getPixelLength());break;case 34:this._autoScroll(-this._timeline.getPixelLength());break;default:return!0}this.closeBubble();SimileAjax.DOM.cancelEvent(b);return!1}return!0};
Timeline._Band.prototype._autoScroll=function(a,b){var c=this;SimileAjax.Graphics.createAnimation(function(a,b){c._moveEther(b)},0,a,1E3,b).run()};
Timeline._Band.prototype._moveEther=function(a){this.closeBubble();if(this._timeline.shiftOK(this._index,a))this._viewOffset+=a,this._ether.shiftPixels(-a),this._timeline.isHorizontal()?this._div.style.left=this._viewOffset+"px":this._div.style.top=this._viewOffset+"px",this._viewOffset>-this._viewLength*0.5||this._viewOffset<-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1.5)?this._recenterDiv():this.softLayout(),this._onChanging()};
Timeline._Band.prototype._onChanging=function(){this._changing=!0;this._fireOnScroll();this._setSyncWithBandDate();this._changing=!1};Timeline._Band.prototype.busy=function(){return this._changing};Timeline._Band.prototype._fireOnScroll=function(){for(var a=0;a<this._onScrollListeners.length;a++)this._onScrollListeners[a](this)};Timeline._Band.prototype._setSyncWithBandDate=function(){this._syncWithBand&&this._syncWithBand.setCenterVisibleDate(this._ether.pixelOffsetToDate(this.getViewLength()/2))};
Timeline._Band.prototype._onHighlightBandScroll=function(){if(this._syncWithBand){var a=this._ether.dateToPixelOffset(this._syncWithBand.getCenterVisibleDate());this._moveEther(Math.round(this._viewLength/2-a));this._highlight&&this._etherPainter.setHighlight(this._syncWithBand.getMinVisibleDate(),this._syncWithBand.getMaxVisibleDate())}};Timeline._Band.prototype._onAddMany=function(){this._paintEvents()};Timeline._Band.prototype._onClear=function(){this._paintEvents()};
Timeline._Band.prototype._positionHighlight=function(){if(this._syncWithBand){var a=this._syncWithBand.getMinVisibleDate(),b=this._syncWithBand.getMaxVisibleDate();this._highlight&&this._etherPainter.setHighlight(a,b)}};
Timeline._Band.prototype._recenterDiv=function(){this._viewOffset=-this._viewLength*(Timeline._Band.SCROLL_MULTIPLES-1)/2;this._timeline.isHorizontal()?(this._div.style.left=this._viewOffset+"px",this._div.style.width=Timeline._Band.SCROLL_MULTIPLES*this._viewLength+"px"):(this._div.style.top=this._viewOffset+"px",this._div.style.height=Timeline._Band.SCROLL_MULTIPLES*this._viewLength+"px");this.layout()};Timeline._Band.prototype._paintEvents=function(){this._eventPainter.paint()};
Timeline._Band.prototype._softPaintEvents=function(){this._eventPainter.softPaint()};Timeline._Band.prototype._paintDecorators=function(){for(var a=0;a<this._decorators.length;a++)this._decorators[a].paint()};Timeline._Band.prototype._softPaintDecorators=function(){for(var a=0;a<this._decorators.length;a++)this._decorators[a].softPaint()};Timeline._Band.prototype.closeBubble=function(){SimileAjax.WindowManager.cancelPopups()};
Timeline.CompactEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._frc=this._highlightMatcher=this._filterMatcher=null;this._eventIdToElmt={}};Timeline.CompactEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._eventIdToElmt=this._highlightLayer=this._lineLayer=this._eventLayer=this._backLayer=null};Timeline.CompactEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};
Timeline.CompactEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.CompactEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.CompactEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.CompactEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.CompactEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.CompactEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(a!=null){this._eventIdToElmt={};this._prepareForPainting();var b=this._params.theme,c=b.event,b={trackOffset:"trackOffset"in this._params?this._params.trackOffset:10,trackHeight:"trackHeight"in this._params?this._params.trackHeight:10,tapeHeight:b.event.tape.height,tapeBottomMargin:"tapeBottomMargin"in this._params?this._params.tapeBottomMargin:2,labelBottomMargin:"labelBottomMargin"in this._params?this._params.labelBottomMargin:
5,labelRightMargin:"labelRightMargin"in this._params?this._params.labelRightMargin:5,defaultIcon:c.instant.icon,defaultIconWidth:c.instant.iconWidth,defaultIconHeight:c.instant.iconHeight,customIconWidth:"iconWidth"in this._params?this._params.iconWidth:c.instant.iconWidth,customIconHeight:"iconHeight"in this._params?this._params.iconHeight:c.instant.iconHeight,iconLabelGap:"iconLabelGap"in this._params?this._params.iconLabelGap:2,iconBottomMargin:"iconBottomMargin"in this._params?this._params.iconBottomMargin:
2};"compositeIcon"in this._params?(b.compositeIcon=this._params.compositeIcon,b.compositeIconWidth=this._params.compositeIconWidth||b.customIconWidth,b.compositeIconHeight=this._params.compositeIconHeight||b.customIconHeight):(b.compositeIcon=b.defaultIcon,b.compositeIconWidth=b.defaultIconWidth,b.compositeIconHeight=b.defaultIconHeight);b.defaultStackIcon="icon"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.icon:b.defaultIcon;b.defaultStackIconWidth=
"iconWidth"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconWidth:b.defaultIconWidth;b.defaultStackIconHeight="iconHeight"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.iconHeight:b.defaultIconHeight;var d=this._band.getMinDate(),f=this._band.getMaxDate(),g=this._filterMatcher!=null?this._filterMatcher:function(){return!0},c=this._highlightMatcher!=null?this._highlightMatcher:function(){return-1},
f=a.getEventIterator(d,f),a="stackConcurrentPreciseInstantEvents"in this._params&&typeof this._params.stackConcurrentPreciseInstantEvents=="object";if("collapseConcurrentPreciseInstantEvents"in this._params&&this._params.collapseConcurrentPreciseInstantEvents||a){for(var d=[],e=null;f.hasNext();){var h=f.next();g(h)&&(!h.isInstant()||h.isImprecise()?this.paintEvent(h,b,this._params.theme,c(h)):e!=null&&e.getStart().getTime()==h.getStart().getTime()?d[d.length-1].push(h):(d.push([h]),e=h))}for(g=0;g<
d.length;g++)if(f=d[g],f.length==1)this.paintEvent(f[0],b,this._params.theme,c(h));else{for(var e=-1,i=0;e<0&&i<f.length;i++)e=c(f[i]);a?this.paintStackedPreciseInstantEvents(f,b,this._params.theme,e):this.paintCompositePreciseInstantEvents(f,b,this._params.theme,e)}}else for(;f.hasNext();)h=f.next(),g(h)&&this.paintEvent(h,b,this._params.theme,c(h));this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block"}};
Timeline.CompactEventPainter.prototype.softPaint=function(){};
Timeline.CompactEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(this._backLayer==null){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label";this._backLayer.appendChild(b);this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update();this._tracks=[];this._highlightLayer!=null&&a.removeLayerDiv(this._highlightLayer);this._highlightLayer=
a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";this._lineLayer!=null&&a.removeLayerDiv(this._lineLayer);this._lineLayer=a.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";this._eventLayer!=null&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(115,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.CompactEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.CompactEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)};Timeline.CompactEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)};
Timeline.CompactEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){var f={tooltip:a.getProperty("tooltip")||a.getText()},g={url:a.getIcon()};g.url==null?(g.url=b.defaultIcon,g.width=b.defaultIconWidth,g.height=b.defaultIconHeight,g.className="timeline-event-icon-default"):(g.width=a.getProperty("iconWidth")||b.customIconWidth,g.height=a.getProperty("iconHeight")||b.customIconHeight);var e={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},h=this.paintTapeIconLabel(a.getStart(),
f,null,g,e,b,c,d),i=this,b=function(b,c){return i._onClickInstantEvent(h.iconElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(h.iconElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(h.labelElmtData.elmt,"mousedown",b);this._eventIdToElmt[a.getID()]=h.iconElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintCompositePreciseInstantEvents=function(a,b,c,d){for(var f=a[0],g=[],e=0;e<a.length;e++)g.push(a[e].getProperty("tooltip")||a[e].getText());var g={tooltip:g.join("; ")},e={url:b.compositeIcon,width:b.compositeIconWidth,height:b.compositeIconHeight,className:"timeline-event-icon-composite"},h={text:String.substitute(this._params.compositeEventLabelTemplate,[a.length])},i=this.paintTapeIconLabel(f.getStart(),g,null,e,h,b,c,d),j=this,b=function(b,c){return j._onClickMultiplePreciseInstantEvent(i.iconElmtData.elmt,
c,a)};SimileAjax.DOM.registerEvent(i.iconElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(i.labelElmtData.elmt,"mousedown",b);for(e=0;e<a.length;e++)this._eventIdToElmt[a[e].getID()]=i.iconElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintStackedPreciseInstantEvents=function(a,b,c){var d="limit"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.limit:10,f="moreMessageTemplate"in this._params.stackConcurrentPreciseInstantEvents?this._params.stackConcurrentPreciseInstantEvents.moreMessageTemplate:"%0 More Events",g=d<=a.length-2,e=this._band,h=function(a){var c={url:a.getIcon()};c.url==null?(c.url=b.defaultStackIcon,c.width=b.defaultStackIconWidth,
c.height=b.defaultStackIconHeight,c.className="timeline-event-icon-stack timeline-event-icon-default"):(c.width=a.getProperty("iconWidth")||b.customIconWidth,c.height=a.getProperty("iconHeight")||b.customIconHeight,c.className="timeline-event-icon-stack");return c},i=h(a[0]),j=0,l=0,k=0,n=0,p=[],m=0;for(;m<a.length&&(!g||m<d);m++){var o=a[m],q=o.getText(),o=h(o),r=this._frc.computeSize(q),q={text:q,iconData:o,labelSize:r,iconLeft:i.width+m*5-o.width};q.labelLeft=i.width+m*5+b.iconLabelGap;q.top=k;
p.push(q);j=Math.min(j,q.iconLeft);k+=r.height;l=Math.max(l,q.labelLeft+r.width);n=Math.max(n,q.top+o.height)}if(g){var w=String.substitute(f,[a.length-d]),u=this._frc.computeSize(w),A=i.width+(d-1)*5+b.iconLabelGap,C=k;k+=u.height;l=Math.max(l,A+u.width)}l+=b.labelRightMargin;k+=b.labelBottomMargin;n+=b.iconBottomMargin;for(var v=function(a){return Math.round(e.dateToPixelOffset(a))}(a[0].getStart()),f=[],h=Math.ceil(Math.max(n,k)/b.trackHeight),i=i.width+(a.length-1)*5,m=0;m<h;m++)f.push({start:j,
end:i});j=Math.ceil(k/b.trackHeight);for(m=0;m<j;m++)k=f[m],k.end=Math.max(k.end,l);var x=this._fitTracks(v,f)*b.trackHeight+b.trackOffset,s=this._timeline.getDocument().createElement("div");s.className="timeline-event-icon-stack";s.style.position="absolute";s.style.overflow="visible";s.style.left=v+"px";s.style.top=x+"px";s.style.width=i+"px";s.style.height=n+"px";s.innerHTML="<div style='position: relative'></div>";this._eventLayer.appendChild(s);var t=this,B=function(){try{for(var a=parseInt(this.getAttribute("index")),
b=s.firstChild.childNodes,c=0;c<b.length;c++)b[c].style.zIndex=c==a?b.length:b.length-c}catch(d){}},l=function(b){var d=p[b],g=a[b],e=g.getProperty("tooltip")||g.getText(),f=t._paintEventLabel({tooltip:e},{text:d.text},v+d.labelLeft,x+d.top,d.labelSize.width,d.labelSize.height,c);f.elmt.setAttribute("index",b);f.elmt.onmouseover=B;var h=SimileAjax.Graphics.createTranslucentImage(d.iconData.url),e=t._timeline.getDocument().createElement("div");e.className="timeline-event-icon"+("className"in d.iconData?
" "+d.iconData.className:"");e.style.left=d.iconLeft+"px";e.style.top=d.top+"px";e.style.zIndex=p.length-b;e.appendChild(h);e.setAttribute("index",b);e.onmouseover=B;s.firstChild.appendChild(e);b=function(a,b){return t._onClickInstantEvent(f.elmt,b,g)};SimileAjax.DOM.registerEvent(e,"mousedown",b);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",b);t._eventIdToElmt[g.getID()]=e},m=0;for(;m<p.length;m++)l(m);if(g){var y=a.slice(d),z=this._paintEventLabel({tooltip:w},{text:w},v+A,x+C,u.width,u.height,
c);SimileAjax.DOM.registerEvent(z.elmt,"mousedown",function(a,b){return t._onClickMultiplePreciseInstantEvent(z.elmt,b,y)});for(m=0;m<y.length;m++)this._eventIdToElmt[y[m].getID()]=z.elmt}};
Timeline.CompactEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){var f={tooltip:a.getProperty("tooltip")||a.getText()},g={start:a.getStart(),end:a.getEnd(),latestStart:a.getLatestStart(),earliestEnd:a.getEarliestEnd(),isInstant:!0},e={url:a.getIcon()};e.url==null?e=null:(e.width=a.getProperty("iconWidth")||b.customIconWidth,e.height=a.getProperty("iconHeight")||b.customIconHeight);var h={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},i=this.paintTapeIconLabel(a.getStart(),
f,g,e,h,b,c,d),j=this,b=e!=null?function(b,c){return j._onClickInstantEvent(i.iconElmtData.elmt,c,a)}:function(b,c){return j._onClickInstantEvent(i.labelElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(i.labelElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(i.impreciseTapeElmtData.elmt,"mousedown",b);e!=null?(SimileAjax.DOM.registerEvent(i.iconElmtData.elmt,"mousedown",b),this._eventIdToElmt[a.getID()]=i.iconElmtData.elmt):this._eventIdToElmt[a.getID()]=i.labelElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){var f={tooltip:a.getProperty("tooltip")||a.getText()},g={start:a.getStart(),end:a.getEnd(),isInstant:!1},e={url:a.getIcon()};e.url==null?e=null:(e.width=a.getProperty("iconWidth")||b.customIconWidth,e.height=a.getProperty("iconHeight")||b.customIconHeight);var h={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},i=this.paintTapeIconLabel(a.getLatestStart(),f,g,e,h,b,c,d),j=this,b=e!=
null?function(b,c){return j._onClickInstantEvent(i.iconElmtData.elmt,c,a)}:function(b,c){return j._onClickInstantEvent(i.labelElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(i.labelElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(i.tapeElmtData.elmt,"mousedown",b);e!=null?(SimileAjax.DOM.registerEvent(i.iconElmtData.elmt,"mousedown",b),this._eventIdToElmt[a.getID()]=i.iconElmtData.elmt):this._eventIdToElmt[a.getID()]=i.labelElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){var f={tooltip:a.getProperty("tooltip")||a.getText()},g={start:a.getStart(),end:a.getEnd(),latestStart:a.getLatestStart(),earliestEnd:a.getEarliestEnd(),isInstant:!1},e={url:a.getIcon()};e.url==null?e=null:(e.width=a.getProperty("iconWidth")||b.customIconWidth,e.height=a.getProperty("iconHeight")||b.customIconHeight);var h={text:a.getText(),color:a.getTextColor()||a.getColor(),className:a.getClassName()},i=this.paintTapeIconLabel(a.getLatestStart(),
f,g,e,h,b,c,d),j=this,b=e!=null?function(b,c){return j._onClickInstantEvent(i.iconElmtData.elmt,c,a)}:function(b,c){return j._onClickInstantEvent(i.labelElmtData.elmt,c,a)};SimileAjax.DOM.registerEvent(i.labelElmtData.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(i.tapeElmtData.elmt,"mousedown",b);e!=null?(SimileAjax.DOM.registerEvent(i.iconElmtData.elmt,"mousedown",b),this._eventIdToElmt[a.getID()]=i.iconElmtData.elmt):this._eventIdToElmt[a.getID()]=i.labelElmtData.elmt};
Timeline.CompactEventPainter.prototype.paintTapeIconLabel=function(a,b,c,d,f,g,e){var h=this._band,i=function(a){return Math.round(h.dateToPixelOffset(a))},a=i(a),j=[],l=0,k=0,n=0;if(c!=null){for(var l=g.tapeHeight+g.tapeBottomMargin,k=Math.ceil(g.tapeHeight/g.trackHeight),p=i(c.end)-a,m=i(c.start)-a,o=0;o<k;o++)j.push({start:m,end:p});n=g.trackHeight-l%g.tapeHeight}m=p=0;if(d!=null){"iconAlign"in d&&d.iconAlign=="center"&&(p=-Math.floor(d.width/2));m=p+d.width+g.iconLabelGap;if(k>0)j[k-1].end=Math.max(j[k-
1].end,m);for(o=d.height+g.iconBottomMargin+n;o>0;)j.push({start:p,end:m}),o-=g.trackHeight}var o=this._frc.computeSize(f.text),n=o.height+g.labelBottomMargin+n,q=m+o.width+g.labelRightMargin;if(k>0)j[k-1].end=Math.max(j[k-1].end,q);for(var r=0;n>0;r++)k+r<j.length?j[k+r].end=q:j.push({start:0,end:q}),n-=g.trackHeight;j=this._fitTracks(a,j)*g.trackHeight+g.trackOffset;k={};k.labelElmtData=this._paintEventLabel(b,f,a+m,j+l,o.width,o.height,e);if(c!=null){if("latestStart"in c||"earliestEnd"in c)k.impreciseTapeElmtData=
this._paintEventTape(b,c,g.tapeHeight,j,i(c.start),i(c.end),e.event.duration.impreciseColor,e.event.duration.impreciseOpacity,g,e);if(!c.isInstant&&"start"in c&&"end"in c)k.tapeElmtData=this._paintEventTape(b,c,g.tapeHeight,j,a,i("earliestEnd"in c?c.earliestEnd:c.end),c.color,100,g,e)}if(d!=null)k.iconElmtData=this._paintEventIcon(b,d,j+l,a+p,g,e);return k};
Timeline.CompactEventPainter.prototype._fitTracks=function(a,b){var c;for(c=0;c<this._tracks.length;c++){for(var d=!0,f=0;f<b.length&&c+f<this._tracks.length;f++)if(a+b[f].start<this._tracks[c+f]){d=!1;break}if(d)break}for(d=0;d<b.length;d++)this._tracks[c+d]=a+b[d].end;return c};
Timeline.CompactEventPainter.prototype._paintEventIcon=function(a,b,c,d,f){var g=SimileAjax.Graphics.createTranslucentImage(b.url),e=this._timeline.getDocument().createElement("div");e.className="timeline-event-icon"+("className"in b?" "+b.className:"");e.style.left=d+"px";e.style.top=c+"px";e.appendChild(g);if("tooltip"in a&&typeof a.tooltip=="string")e.title=a.tooltip;this._eventLayer.appendChild(e);return{left:d,top:c,width:f.iconWidth,height:f.iconHeight,elmt:e}};
Timeline.CompactEventPainter.prototype._paintEventLabel=function(a,b,c,d,f,g){var e=this._timeline.getDocument().createElement("div");e.className="timeline-event-label";e.style.left=c+"px";e.style.width=f+1+"px";e.style.top=d+"px";e.innerHTML=b.text;if("tooltip"in a&&typeof a.tooltip=="string")e.title=a.tooltip;if("color"in b&&typeof b.color=="string")e.style.color=b.color;"className"in b&&typeof b.className=="string"&&(e.className+=" "+b.className);this._eventLayer.appendChild(e);return{left:c,top:d,
width:f,height:g,elmt:e}};
Timeline.CompactEventPainter.prototype._paintEventTape=function(a,b,c,d,f,g,e,h){g-=f;var i=this._timeline.getDocument().createElement("div");i.className="timeline-event-tape";i.style.left=f+"px";i.style.top=d+"px";i.style.width=g+"px";i.style.height=c+"px";if("tooltip"in a&&typeof a.tooltip=="string")i.title=a.tooltip;if(e!=null&&typeof b.color=="string")i.style.backgroundColor=e;if("backgroundImage"in b&&typeof b.backgroundImage=="string")i.style.backgroundImage="url("+backgroundImage+")",i.style.backgroundRepeat=
"backgroundRepeat"in b&&typeof b.backgroundRepeat=="string"?b.backgroundRepeat:"repeat";SimileAjax.Graphics.setOpacity(i,h);"className"in b&&typeof b.className=="string"&&(i.className+=" "+b.className);this._eventLayer.appendChild(i);return{left:f,top:d,width:g,height:c,elmt:i}};
Timeline.CompactEventPainter.prototype._createHighlightDiv=function(a,b,c){if(a>=0){var d=this._timeline.getDocument();Math.min(a,c.event.highlightColors.length-1);a=d.createElement("div");a.style.position="absolute";a.style.overflow="hidden";a.style.left=b.left-2+"px";a.style.width=b.width+4+"px";a.style.top=b.top-2+"px";a.style.height=b.height+4+"px";this._highlightLayer.appendChild(a)}};
Timeline.CompactEventPainter.prototype._onClickMultiplePreciseInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c);a=[];for(d=0;d<c.length;d++)a.push(c[d].getID());this._fireOnSelect(a);b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.CompactEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),[c]);this._fireOnSelect([c.getID()]);b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.CompactEventPainter.prototype._onClickDurationEvent=function(a,b,c){if("pageX"in b)var a=b.pageX,d=b.pageY;else d=SimileAjax.DOM.getPageCoordinates(a),a=b.offsetX+d.left,d=b.offsetY+d.top;this._showBubble(a,d,[c]);this._fireOnSelect([c.getID()]);b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.CompactEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,[a])}};
Timeline.CompactEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div"),c="fillInfoBubble"in c?[c]:c,f=0;for(;f<c.length;f++){var g=document.createElement("div");d.appendChild(g);c[f].fillInfoBubble(g,this._params.theme,this._band.getLabeller())}SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,this._params.theme.event.bubble.width)};Timeline.CompactEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)};
Timeline.SpanHighlightDecorator=function(a){this._unit=a.unit!=null?a.unit:SimileAjax.NativeDateUnit;this._startDate=typeof a.startDate=="string"?this._unit.parseFromObject(a.startDate):a.startDate;this._endDate=typeof a.endDate=="string"?this._unit.parseFromObject(a.endDate):a.endDate;this._startLabel=a.startLabel!=null?a.startLabel:"";this._endLabel=a.endLabel!=null?a.endLabel:"";this._color=a.color;this._cssClass=a.cssClass!=null?a.cssClass:null;this._opacity=a.opacity!=null?a.opacity:100;this._zIndex=
a.inFront!=null&&a.inFront?113:10};Timeline.SpanHighlightDecorator.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._layerDiv=null};
Timeline.SpanHighlightDecorator.prototype.paint=function(){this._layerDiv!=null&&this._band.removeLayerDiv(this._layerDiv);this._layerDiv=this._band.createLayerDiv(this._zIndex);this._layerDiv.setAttribute("name","span-highlight-decorator");this._layerDiv.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate();if(this._unit.compare(this._startDate,b)<0&&this._unit.compare(this._endDate,a)>0){var a=this._unit.later(a,this._startDate),b=this._unit.earlier(b,this._endDate),a=this._band.dateToPixelOffset(a),
b=this._band.dateToPixelOffset(b),c=this._timeline.getDocument(),d=function(){var a=c.createElement("table");a.insertRow(0).insertCell(0);return a},f=c.createElement("div");f.className="timeline-highlight-decorator";this._cssClass&&(f.className+=" "+this._cssClass);if(this._color!=null)f.style.backgroundColor=this._color;this._opacity<100&&SimileAjax.Graphics.setOpacity(f,this._opacity);this._layerDiv.appendChild(f);var g=d();g.className="timeline-highlight-label timeline-highlight-label-start";var e=
g.rows[0].cells[0];e.innerHTML=this._startLabel;if(this._cssClass)e.className="label_"+this._cssClass;this._layerDiv.appendChild(g);d=d();d.className="timeline-highlight-label timeline-highlight-label-end";e=d.rows[0].cells[0];e.innerHTML=this._endLabel;if(this._cssClass)e.className="label_"+this._cssClass;this._layerDiv.appendChild(d);this._timeline.isHorizontal()?(f.style.left=a+"px",f.style.width=b-a+"px",g.style.right=this._band.getTotalViewLength()-a+"px",g.style.width=this._startLabel.length+
"em",d.style.left=b+"px",d.style.width=this._endLabel.length+"em"):(f.style.top=a+"px",f.style.height=b-a+"px",g.style.bottom=a+"px",g.style.height="1.5px",d.style.top=b+"px",d.style.height="1.5px")}this._layerDiv.style.display="block"};Timeline.SpanHighlightDecorator.prototype.softPaint=function(){};
Timeline.PointHighlightDecorator=function(a){this._unit=a.unit!=null?a.unit:SimileAjax.NativeDateUnit;this._date=typeof a.date=="string"?this._unit.parseFromObject(a.date):a.date;this._width=a.width!=null?a.width:10;this._color=a.color;this._cssClass=a.cssClass!=null?a.cssClass:"";this._opacity=a.opacity!=null?a.opacity:100};Timeline.PointHighlightDecorator.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._layerDiv=null};
Timeline.PointHighlightDecorator.prototype.paint=function(){this._layerDiv!=null&&this._band.removeLayerDiv(this._layerDiv);this._layerDiv=this._band.createLayerDiv(10);this._layerDiv.setAttribute("name","span-highlight-decorator");this._layerDiv.style.display="none";var a=this._band.getMinDate();if(this._unit.compare(this._date,this._band.getMaxDate())<0&&this._unit.compare(this._date,a)>0){var a=this._band.dateToPixelOffset(this._date)-Math.round(this._width/2),b=this._timeline.getDocument().createElement("div");
b.className="timeline-highlight-point-decorator";b.className+=" "+this._cssClass;if(this._color!=null)b.style.backgroundColor=this._color;this._opacity<100&&SimileAjax.Graphics.setOpacity(b,this._opacity);this._layerDiv.appendChild(b);this._timeline.isHorizontal()?(b.style.left=a+"px",b.style.width=this._width):(b.style.top=a+"px",b.style.height=this._width)}this._layerDiv.style.display="block"};Timeline.PointHighlightDecorator.prototype.softPaint=function(){};
Timeline.DetailedEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._frc=this._highlightMatcher=this._filterMatcher=null;this._eventIdToElmt={}};Timeline.DetailedEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._eventIdToElmt=this._highlightLayer=this._lineLayer=this._eventLayer=this._backLayer=null};Timeline.DetailedEventPainter.prototype.getType=function(){return"detailed"};Timeline.DetailedEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};
Timeline.DetailedEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.DetailedEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.DetailedEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.DetailedEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.DetailedEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.DetailedEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(a!=null){this._eventIdToElmt={};this._prepareForPainting();for(var b=this._params.theme.event,c=Math.max(b.track.height,this._frc.getLineHeight()),b={trackOffset:Math.round(this._band.getViewWidth()/2-c/2),trackHeight:c,trackGap:b.track.gap,trackIncrement:c+b.track.gap,icon:b.instant.icon,iconWidth:b.instant.iconWidth,iconHeight:b.instant.iconHeight,labelWidth:b.label.width},d=this._band.getMinDate(),f=this._band.getMaxDate(),
c=this._filterMatcher!=null?this._filterMatcher:function(){return!0},g=this._highlightMatcher!=null?this._highlightMatcher:function(){return-1},a=a.getEventReverseIterator(d,f);a.hasNext();)d=a.next(),c(d)&&this.paintEvent(d,b,this._params.theme,g(d));this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._lowerTracks.length+this._upperTracks.length,b.trackIncrement)}};
Timeline.DetailedEventPainter.prototype.softPaint=function(){};
Timeline.DetailedEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(this._backLayer==null){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label";this._backLayer.appendChild(b);this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update();this._lowerTracks=[];this._upperTracks=[];this._highlightLayer!=null&&a.removeLayerDiv(this._highlightLayer);
this._highlightLayer=a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";this._lineLayer!=null&&a.removeLayerDiv(this._lineLayer);this._lineLayer=a.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";this._eventLayer!=null&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(110,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.DetailedEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.DetailedEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)};Timeline.DetailedEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)};
Timeline.DetailedEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),g=a.getStart(),e=Math.round(this._band.dateToPixelOffset(g)),h=Math.round(e+b.iconWidth/2),i=Math.round(e-b.iconWidth/2),g=this._frc.computeSize(f),j=this._findFreeTrackForSolid(h,e),l=this._paintEventIcon(a,j,i,b,c);h+=c.event.label.offsetFromLine;var k=j,n=this._getTrackData(j);Math.min(n.solid,n.text)>=h+g.width?(n.solid=i,n.text=h):(n.solid=i,h=e+c.event.label.offsetFromLine,
k=this._findFreeTrackForText(j,h+g.width,function(a){a.line=e-2}),this._getTrackData(k).text=i,this._paintEventLine(a,e,j,k,b,c));var b=Math.round(b.trackOffset+k*b.trackIncrement+b.trackHeight/2-g.height/2),f=this._paintEventLabel(a,f,h,b,g.width,g.height,c),p=this,b=function(b,c){return p._onClickInstantEvent(l.elmt,c,a)};SimileAjax.DOM.registerEvent(l.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",b);this._createHighlightDiv(d,l,c);this._eventIdToElmt[a.getID()]=l.elmt};
Timeline.DetailedEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),g=a.getStart(),e=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(g)),i=Math.round(this._band.dateToPixelOffset(e)),j=Math.round(h+b.iconWidth/2),l=Math.round(h-b.iconWidth/2),e=this._frc.computeSize(f),k=this._findFreeTrackForSolid(i,h),g=this._paintEventTape(a,k,h,i,c.event.instant.impreciseColor,c.event.instant.impreciseOpacity,b,c),n=this._paintEventIcon(a,k,
l,b,c);this._getTrackData(k).solid=l;j+=c.event.label.offsetFromLine;var p=j+e.width;p<i?i=k:(j=h+c.event.label.offsetFromLine,p=j+e.width,i=this._findFreeTrackForText(k,p,function(a){a.line=h-2}),this._getTrackData(i).text=l,this._paintEventLine(a,h,k,i,b,c));var b=Math.round(b.trackOffset+i*b.trackIncrement+b.trackHeight/2-e.height/2),f=this._paintEventLabel(a,f,j,b,e.width,e.height,c),m=this,b=function(b,c){return m._onClickInstantEvent(n.elmt,c,a)};SimileAjax.DOM.registerEvent(n.elmt,"mousedown",
b);SimileAjax.DOM.registerEvent(g.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",b);this._createHighlightDiv(d,n,c);this._eventIdToElmt[a.getID()]=n.elmt};
Timeline.DetailedEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),g=a.getStart(),e=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(g)),i=Math.round(this._band.dateToPixelOffset(e)),g=this._frc.computeSize(f),e=this._findFreeTrackForSolid(i),j=a.getColor(),j=j!=null?j:c.event.duration.color,l=this._paintEventTape(a,e,h,i,j,100,b,c);this._getTrackData(e).solid=h;i=h+c.event.label.offsetFromLine;j=this._findFreeTrackForText(e,i+g.width,
function(a){a.line=h-2});this._getTrackData(j).text=h-2;this._paintEventLine(a,h,e,j,b,c);var b=Math.round(b.trackOffset+j*b.trackIncrement+b.trackHeight/2-g.height/2),f=this._paintEventLabel(a,f,i,b,g.width,g.height,c),k=this,b=function(b,c){return k._onClickDurationEvent(l.elmt,c,a)};SimileAjax.DOM.registerEvent(l.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",b);this._createHighlightDiv(d,l,c);this._eventIdToElmt[a.getID()]=l.elmt};
Timeline.DetailedEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),g=a.getStart(),e=a.getLatestStart(),h=a.getEnd(),i=a.getEarliestEnd(),g=Math.round(this._band.dateToPixelOffset(g)),j=Math.round(this._band.dateToPixelOffset(e)),h=Math.round(this._band.dateToPixelOffset(h)),l=Math.round(this._band.dateToPixelOffset(i)),i=this._frc.computeSize(f),e=this._findFreeTrackForSolid(h),k=a.getColor(),k=k!=null?k:c.event.duration.color;this._paintEventTape(a,
e,g,h,c.event.duration.impreciseColor,c.event.duration.impreciseOpacity,b,c);var n=this._paintEventTape(a,e,j,l,k,100,b,c);this._getTrackData(e).solid=g;g=j+c.event.label.offsetFromLine;h=this._findFreeTrackForText(e,g+i.width,function(a){a.line=j-2});this._getTrackData(h).text=j-2;this._paintEventLine(a,j,e,h,b,c);var b=Math.round(b.trackOffset+h*b.trackIncrement+b.trackHeight/2-i.height/2),f=this._paintEventLabel(a,f,g,b,i.width,i.height,c),p=this,b=function(b,c){return p._onClickDurationEvent(n.elmt,
c,a)};SimileAjax.DOM.registerEvent(n.elmt,"mousedown",b);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",b);this._createHighlightDiv(d,n,c);this._eventIdToElmt[a.getID()]=n.elmt};
Timeline.DetailedEventPainter.prototype._findFreeTrackForSolid=function(a,b){for(var c=0;;c++){if(c<this._lowerTracks.length){var d=this._lowerTracks[c];if(Math.min(d.solid,d.text)>a&&(!b||d.line>b))return c}else return this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),c;if(c<this._upperTracks.length){if(d=this._upperTracks[c],Math.min(d.solid,d.text)>a&&(!b||d.line>b))return-1-c}else return this._upperTracks.push({solid:Number.POSITIVE_INFINITY,
text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY}),-1-c}};
Timeline.DetailedEventPainter.prototype._findFreeTrackForText=function(a,b,c){var d,f;a<0?(d=!0,a=-a,b=this._findFreeUpperTrackForText(a,b),f=-1-b):a>0?(d=!1,a+=1,f=b=this._findFreeLowerTrackForText(a,b)):(f=this._findFreeUpperTrackForText(0,b),b=this._findFreeLowerTrackForText(1,b),b-1<=f?(d=!1,a=1,f=b):(d=!0,a=0,b=f,f=-1-b));if(d){b==this._upperTracks.length&&this._upperTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});for(d=a;d<b;d++)c(this._upperTracks[d])}else{b==
this._lowerTracks.length&&this._lowerTracks.push({solid:Number.POSITIVE_INFINITY,text:Number.POSITIVE_INFINITY,line:Number.POSITIVE_INFINITY});for(d=a;d<b;d++)c(this._lowerTracks[d])}return f};Timeline.DetailedEventPainter.prototype._findFreeLowerTrackForText=function(a,b){for(;a<this._lowerTracks.length;a++){var c=this._lowerTracks[a];if(Math.min(c.solid,c.text)>=b)break}return a};
Timeline.DetailedEventPainter.prototype._findFreeUpperTrackForText=function(a,b){for(;a<this._upperTracks.length;a++){var c=this._upperTracks[a];if(Math.min(c.solid,c.text)>=b)break}return a};Timeline.DetailedEventPainter.prototype._getTrackData=function(a){return a<0?this._upperTracks[-a-1]:this._lowerTracks[a]};
Timeline.DetailedEventPainter.prototype._paintEventLine=function(a,b,c,d,f,g){var a=Math.round(f.trackOffset+c*f.trackIncrement+f.trackHeight/2),f=Math.round(Math.abs(d-c)*f.trackIncrement),e="1px solid "+g.event.label.lineColor,h=this._timeline.getDocument().createElement("div");h.style.position="absolute";h.style.left=b+"px";h.style.width=g.event.label.offsetFromLine+"px";h.style.height=f+"px";c>d?(h.style.top=a-f+"px",h.style.borderTop=e):(h.style.top=a+"px",h.style.borderBottom=e);h.style.borderLeft=
e;this._lineLayer.appendChild(h)};
Timeline.DetailedEventPainter.prototype._paintEventIcon=function(a,b,c,d){var f=a.getIcon(),f=f!=null?f:d.icon,b=Math.round(d.trackOffset+b*d.trackIncrement+d.trackHeight/2-d.iconHeight/2),f=SimileAjax.Graphics.createTranslucentImage(f),g=this._timeline.getDocument().createElement("div");g.style.position="absolute";g.style.left=c+"px";g.style.top=b+"px";g.appendChild(f);g.style.cursor="pointer";if(a._title!=null)g.title=a._title;this._eventLayer.appendChild(g);return{left:c,top:b,width:d.iconWidth,
height:d.iconHeight,elmt:g}};
Timeline.DetailedEventPainter.prototype._paintEventLabel=function(a,b,c,d,f,g,e){var h=this._timeline.getDocument(),i=h.createElement("div");i.style.position="absolute";i.style.left=c+"px";i.style.width=f+"px";i.style.top=d+"px";i.style.height=g+"px";i.style.backgroundColor=e.event.label.backgroundColor;SimileAjax.Graphics.setOpacity(i,e.event.label.backgroundOpacity);this._eventLayer.appendChild(i);e=h.createElement("div");e.style.position="absolute";e.style.left=c+"px";e.style.width=f+"px";e.style.top=
d+"px";e.innerHTML=b;e.style.cursor="pointer";if(a._title!=null)e.title=a._title;b=a.getTextColor();b==null&&(b=a.getColor());if(b!=null)e.style.color=b;this._eventLayer.appendChild(e);return{left:c,top:d,width:f,height:g,elmt:e}};
Timeline.DetailedEventPainter.prototype._paintEventTape=function(a,b,c,d,f,g,e,h){d-=c;h=h.event.tape.height;b=Math.round(e.trackOffset+b*e.trackIncrement+e.trackHeight/2-h/2);e=this._timeline.getDocument().createElement("div");e.style.position="absolute";e.style.left=c+"px";e.style.width=d+"px";e.style.top=b+"px";e.style.height=h+"px";e.style.backgroundColor=f;e.style.overflow="hidden";e.style.cursor="pointer";if(a._title!=null)e.title=a._title;SimileAjax.Graphics.setOpacity(e,g);this._eventLayer.appendChild(e);
return{left:c,top:b,width:d,height:h,elmt:e}};Timeline.DetailedEventPainter.prototype._createHighlightDiv=function(a,b,c){if(a>=0){var d=this._timeline.getDocument(),c=c.event,a=c.highlightColors[Math.min(a,c.highlightColors.length-1)],d=d.createElement("div");d.style.position="absolute";d.style.overflow="hidden";d.style.left=b.left-2+"px";d.style.width=b.width+4+"px";d.style.top=b.top-2+"px";d.style.height=b.height+4+"px";d.style.background=a;this._highlightLayer.appendChild(d)}};
Timeline.DetailedEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.DetailedEventPainter.prototype._onClickDurationEvent=function(a,b,c){if("pageX"in b)var a=b.pageX,d=b.pageY;else d=SimileAjax.DOM.getPageCoordinates(a),a=b.offsetX+d.left,d=b.offsetY+d.top;this._showBubble(a,d,c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.DetailedEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,a)}};
Timeline.DetailedEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div"),f=this._params.theme.event.bubble;c.fillInfoBubble(d,this._params.theme,this._band.getLabeller());SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,f.width,null,f.maxHeight)};Timeline.DetailedEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)};
Timeline.GregorianEtherPainter=function(a){this._params=a;this._theme=a.theme;this._unit=a.unit;this._multiple="multiple"in a?a.multiple:1};
Timeline.GregorianEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;var c="align"in this._params&&this._params.align!=void 0?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,
this._band,this._theme,c,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.GregorianEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.GregorianEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var a=this._band.getMinDate(),b=this._band.getMaxDate(),
c=this._band.getTimeZone(),d=this._band.getLabeller();SimileAjax.DateTime.roundDownToInterval(a,this._unit,c,this._multiple,this._theme.firstDayOfWeek);for(var f=this,c=function(a){for(var b=0;b<f._multiple;b++)SimileAjax.DateTime.incrementByInterval(a,f._unit)};a.getTime()<b.getTime();)this._intervalMarkerLayout.createIntervalMarker(a,d,this._unit,this._markerLayer,this._lineLayer),c(a);this._markerLayer.style.display="block";this._lineLayer.style.display="block"};
Timeline.GregorianEtherPainter.prototype.softPaint=function(){};Timeline.GregorianEtherPainter.prototype.zoom=function(a){a!=0&&(this._unit+=a)};
Timeline.HotZoneGregorianEtherPainter=function(a){this._params=a;this._theme=a.theme;this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,unit:a.unit,multiple:1}];for(var b=0;b<a.zones.length;b++)for(var c=a.zones[b],d=SimileAjax.DateTime.parseGregorianDateTime(c.start).getTime(),f=SimileAjax.DateTime.parseGregorianDateTime(c.end).getTime(),g=0;g<this._zones.length&&f>d;g++){var e=this._zones[g];if(d<e.endTime){if(d>e.startTime)this._zones.splice(g,0,{startTime:e.startTime,
endTime:d,unit:e.unit,multiple:e.multiple}),g++,e.startTime=d;f<e.endTime?(this._zones.splice(g,0,{startTime:d,endTime:f,unit:c.unit,multiple:c.multiple?c.multiple:1}),g++,d=e.startTime=f):(e.multiple=c.multiple,e.unit=c.unit,d=e.endTime)}}};
Timeline.HotZoneGregorianEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;var c="align"in this._params&&this._params.align!=void 0?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,
this._band,this._theme,c,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.HotZoneGregorianEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.HotZoneGregorianEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";for(var a=this._band.getMinDate(),b=
this._band.getMaxDate(),c=this._band.getTimeZone(),d=this._band.getLabeller(),f=function(a,b){for(var c=0;c<b.multiple;c++)SimileAjax.DateTime.incrementByInterval(a,b.unit)},g=0;g<this._zones.length;){if(a.getTime()<this._zones[g].endTime)break;g++}for(var e=this._zones.length-1;e>=0;){if(b.getTime()>this._zones[e].startTime)break;e--}for(;g<=e;g++){var h=this._zones[g],i=new Date(Math.max(a.getTime(),h.startTime)),j=new Date(Math.min(b.getTime(),h.endTime));SimileAjax.DateTime.roundDownToInterval(i,
h.unit,c,h.multiple,this._theme.firstDayOfWeek);for(SimileAjax.DateTime.roundUpToInterval(j,h.unit,c,h.multiple,this._theme.firstDayOfWeek);i.getTime()<j.getTime();)this._intervalMarkerLayout.createIntervalMarker(i,d,h.unit,this._markerLayer,this._lineLayer),f(i,h)}this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.HotZoneGregorianEtherPainter.prototype.softPaint=function(){};
Timeline.HotZoneGregorianEtherPainter.prototype.zoom=function(a){if(a!=0)for(var b=0;b<this._zones.length;++b)this._zones[b]&&(this._zones[b].unit+=a)};Timeline.YearCountEtherPainter=function(a){this._params=a;this._theme=a.theme;this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate);this._multiple="multiple"in a?a.multiple:1};
Timeline.YearCountEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;var c="align"in this._params?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,
this._theme,c,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.YearCountEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.YearCountEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var a=new Date(this._startDate.getTime()),b=
this._band.getMaxDate(),c=this._band.getMinDate().getUTCFullYear()-this._startDate.getUTCFullYear();a.setUTCFullYear(this._band.getMinDate().getUTCFullYear()-c%this._multiple);for(var d=this,c=function(a){for(var b=0;b<d._multiple;b++)SimileAjax.DateTime.incrementByInterval(a,SimileAjax.DateTime.YEAR)},f={labelInterval:function(a){a=a.getUTCFullYear()-d._startDate.getUTCFullYear();return{text:a,emphasized:a==0}}};a.getTime()<b.getTime();)this._intervalMarkerLayout.createIntervalMarker(a,f,SimileAjax.DateTime.YEAR,
this._markerLayer,this._lineLayer),c(a);this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.YearCountEtherPainter.prototype.softPaint=function(){};Timeline.QuarterlyEtherPainter=function(a){this._params=a;this._theme=a.theme;this._startDate=SimileAjax.DateTime.parseGregorianDateTime(a.startDate)};
Timeline.QuarterlyEtherPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._backgroundLayer=a.createLayerDiv(0);this._backgroundLayer.setAttribute("name","ether-background");this._backgroundLayer.className="timeline-ether-bg";this._lineLayer=this._markerLayer=null;var c="align"in this._params?this._params.align:this._theme.ether.interval.marker[b.isHorizontal()?"hAlign":"vAlign"];this._intervalMarkerLayout=new Timeline.EtherIntervalMarkerLayout(this._timeline,this._band,
this._theme,c,"showLine"in this._params?this._params.showLine:this._theme.ether.interval.line.show);this._highlight=new Timeline.EtherHighlight(this._timeline,this._band,this._theme,this._backgroundLayer)};Timeline.QuarterlyEtherPainter.prototype.setHighlight=function(a,b){this._highlight.position(a,b)};
Timeline.QuarterlyEtherPainter.prototype.paint=function(){this._markerLayer&&this._band.removeLayerDiv(this._markerLayer);this._markerLayer=this._band.createLayerDiv(100);this._markerLayer.setAttribute("name","ether-markers");this._markerLayer.style.display="none";this._lineLayer&&this._band.removeLayerDiv(this._lineLayer);this._lineLayer=this._band.createLayerDiv(1);this._lineLayer.setAttribute("name","ether-lines");this._lineLayer.style.display="none";var a=new Date(0),b=this._band.getMaxDate();
a.setUTCFullYear(Math.max(this._startDate.getUTCFullYear(),this._band.getMinDate().getUTCFullYear()));a.setUTCMonth(this._startDate.getUTCMonth());for(var c=this,d={labelInterval:function(a){var b=(4+(a.getUTCMonth()-c._startDate.getUTCMonth())/3)%4;return b!=0?{text:"Q"+(b+1),emphasized:!1}:{text:"Y"+(a.getUTCFullYear()-c._startDate.getUTCFullYear()+1),emphasized:!0}}};a.getTime()<b.getTime();)this._intervalMarkerLayout.createIntervalMarker(a,d,SimileAjax.DateTime.YEAR,this._markerLayer,this._lineLayer),
a.setUTCMonth(a.getUTCMonth()+3);this._markerLayer.style.display="block";this._lineLayer.style.display="block"};Timeline.QuarterlyEtherPainter.prototype.softPaint=function(){};
Timeline.EtherIntervalMarkerLayout=function(a,b,c,d,f){var g=a.isHorizontal();this.positionDiv=g?d=="Top"?function(a,b){a.style.left=b+"px";a.style.top="0px"}:function(a,b){a.style.left=b+"px";a.style.bottom="0px"}:d=="Left"?function(a,b){a.style.top=b+"px";a.style.left="0px"}:function(a,b){a.style.top=b+"px";a.style.right="0px"};var e=c.ether.interval.line,h=c.ether.interval.weekend,i=SimileAjax.DateTime.gregorianUnitLengths[SimileAjax.DateTime.DAY];this.createIntervalMarker=function(d,l,k,n,p){var m=
Math.round(b.dateToPixelOffset(d));if(f&&k!=SimileAjax.DateTime.WEEK){var o=a.getDocument().createElement("div");o.className="timeline-ether-lines";e.opacity<100&&SimileAjax.Graphics.setOpacity(o,e.opacity);g?o.style.left=m+"px":o.style.top=m+"px";p.appendChild(o)}if(k==SimileAjax.DateTime.WEEK){var o=c.firstDayOfWeek,o=new Date(d.getTime()+(6-o-7)*i),q=new Date(o.getTime()+2*i),o=Math.round(b.dateToPixelOffset(o)),q=Math.round(b.dateToPixelOffset(q)),q=Math.max(1,q-o),r=a.getDocument().createElement("div");
r.className="timeline-ether-weekends";h.opacity<100&&SimileAjax.Graphics.setOpacity(r,h.opacity);g?(r.style.left=o+"px",r.style.width=q+"px"):(r.style.top=o+"px",r.style.height=q+"px");p.appendChild(r)}d=l.labelInterval(d,k);l=a.getDocument().createElement("div");l.innerHTML=d.text;l.className="timeline-date-label";d.emphasized&&(l.className+=" timeline-date-label-em");this.positionDiv(l,m);n.appendChild(l);return l}};
Timeline.EtherHighlight=function(a,b,c,d){var f=a.isHorizontal();this._highlightDiv=null;this._createHighlightDiv=function(){if(this._highlightDiv==null){this._highlightDiv=a.getDocument().createElement("div");this._highlightDiv.setAttribute("name","ether-highlight");this._highlightDiv.className="timeline-ether-highlight";var b=c.ether.highlightOpacity;b<100&&SimileAjax.Graphics.setOpacity(this._highlightDiv,b);d.appendChild(this._highlightDiv)}};this.position=function(a,c){this._createHighlightDiv();
var d=Math.round(b.dateToPixelOffset(a)),i=Math.round(b.dateToPixelOffset(c)),i=Math.max(i-d,3);f?(this._highlightDiv.style.left=d+"px",this._highlightDiv.style.width=i+"px",this._highlightDiv.style.height=b.getViewWidth()-4+"px"):(this._highlightDiv.style.top=d+"px",this._highlightDiv.style.height=i+"px",this._highlightDiv.style.width=b.getViewWidth()-4+"px")}};Timeline.LinearEther=function(a){this._params=a;this._interval=a.interval;this._pixelsPerInterval=a.pixelsPerInterval};
Timeline.LinearEther.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._unit=b.getUnit();"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):(this._start="centersOn"in this._params?this._unit.parseFromObject(this._params.centersOn):this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/
2))};Timeline.LinearEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)};Timeline.LinearEther.prototype.shiftPixels=function(a){this._start=this._unit.change(this._start,this._interval*a/this._pixelsPerInterval)};Timeline.LinearEther.prototype.dateToPixelOffset=function(a){return this._pixelsPerInterval*this._unit.compare(a,this._start)/this._interval};Timeline.LinearEther.prototype.pixelOffsetToDate=function(a){return this._unit.change(this._start,a*this._interval/this._pixelsPerInterval)};
Timeline.LinearEther.prototype.zoom=function(a){var b=0,c=b=this._band._zoomIndex;a&&b>0&&(c=b-1);!a&&b<this._band._zoomSteps.length-1&&(c=b+1);this._band._zoomIndex=c;this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[c].unit];this._pixelsPerInterval=this._band._zoomSteps[c].pixelsPerInterval;return b=this._band._zoomSteps[c].unit-this._band._zoomSteps[b].unit};
Timeline.HotZoneEther=function(a){this._params=a;this._interval=a.interval;this._pixelsPerInterval=a.pixelsPerInterval;this._theme=a.theme};
Timeline.HotZoneEther.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._unit=b.getUnit();this._zones=[{startTime:Number.NEGATIVE_INFINITY,endTime:Number.POSITIVE_INFINITY,magnify:1}];for(var c=this._params,d=0;d<c.zones.length;d++)for(var f=c.zones[d],g=this._unit.parseFromObject(f.start),e=this._unit.parseFromObject(f.end),h=0;h<this._zones.length&&this._unit.compare(e,g)>0;h++){var i=this._zones[h];if(this._unit.compare(g,i.endTime)<0){if(this._unit.compare(g,i.startTime)>0)this._zones.splice(h,
0,{startTime:i.startTime,endTime:g,magnify:i.magnify}),h++,i.startTime=g;this._unit.compare(e,i.endTime)<0?(this._zones.splice(h,0,{startTime:g,endTime:e,magnify:f.magnify*i.magnify}),h++,g=i.startTime=e):(i.magnify*=f.magnify,g=i.endTime)}}"startsOn"in this._params?this._start=this._unit.parseFromObject(this._params.startsOn):"endsOn"in this._params?(this._start=this._unit.parseFromObject(this._params.endsOn),this.shiftPixels(-this._timeline.getPixelLength())):(this._start="centersOn"in this._params?
this._unit.parseFromObject(this._params.centersOn):this._unit.makeDefaultValue(),this.shiftPixels(-this._timeline.getPixelLength()/2))};Timeline.HotZoneEther.prototype.setDate=function(a){this._start=this._unit.cloneValue(a)};Timeline.HotZoneEther.prototype.shiftPixels=function(a){this._start=this.pixelOffsetToDate(a)};Timeline.HotZoneEther.prototype.dateToPixelOffset=function(a){return this._dateDiffToPixelOffset(this._start,a)};
Timeline.HotZoneEther.prototype.pixelOffsetToDate=function(a){return this._pixelOffsetToDate(a,this._start)};Timeline.HotZoneEther.prototype.zoom=function(a){var b=0,c=b=this._band._zoomIndex;a&&b>0&&(c=b-1);!a&&b<this._band._zoomSteps.length-1&&(c=b+1);this._band._zoomIndex=c;this._interval=SimileAjax.DateTime.gregorianUnitLengths[this._band._zoomSteps[c].unit];this._pixelsPerInterval=this._band._zoomSteps[c].pixelsPerInterval;return b=this._band._zoomSteps[c].unit-this._band._zoomSteps[b].unit};
Timeline.HotZoneEther.prototype._dateDiffToPixelOffset=function(a,b){var c=this._getScale(),d=a,f=0;if(this._unit.compare(d,b)<0){for(var g=0;g<this._zones.length;){if(this._unit.compare(d,this._zones[g].endTime)<0)break;g++}for(;this._unit.compare(d,b)<0;){var e=this._zones[g],h=this._unit.earlier(b,e.endTime);f+=this._unit.compare(h,d)/(c/e.magnify);d=h;g++}}else{for(g=this._zones.length-1;g>=0;){if(this._unit.compare(d,this._zones[g].startTime)>0)break;g--}for(;this._unit.compare(d,b)>0;)e=this._zones[g],
h=this._unit.later(b,e.startTime),f+=this._unit.compare(h,d)/(c/e.magnify),d=h,g--}return f};
Timeline.HotZoneEther.prototype._pixelOffsetToDate=function(a,b){var c=this._getScale(),d=b;if(a>0){for(var f=0;f<this._zones.length;){if(this._unit.compare(d,this._zones[f].endTime)<0)break;f++}for(;a>0;){var g=this._zones[f],e=c/g.magnify;if(g.endTime==Number.POSITIVE_INFINITY)d=this._unit.change(d,a*e),a=0;else{var h=this._unit.compare(g.endTime,d)/e;h>a?(d=this._unit.change(d,a*e),a=0):(d=g.endTime,a-=h)}f++}}else{for(f=this._zones.length-1;f>=0;){if(this._unit.compare(d,this._zones[f].startTime)>
0)break;f--}for(a=-a;a>0;)g=this._zones[f],e=c/g.magnify,g.startTime==Number.NEGATIVE_INFINITY?(d=this._unit.change(d,-a*e),a=0):(h=this._unit.compare(d,g.startTime)/e,h>a?(d=this._unit.change(d,-a*e),a=0):(d=g.startTime,a-=h)),f--}return d};Timeline.HotZoneEther.prototype._getScale=function(){return this._interval/this._pixelsPerInterval};Timeline.EventUtils={};Timeline.EventUtils.getNewEventID=function(){if(this._lastEventID==null)this._lastEventID=0;this._lastEventID+=1;return"e"+this._lastEventID};
Timeline.EventUtils.decodeEventElID=function(a){var b=a.split("-");if(b[1]!="tl")return alert("Internal Timeline problem 101, please consult support"),{band:null,evt:null};a=Timeline.getTimelineFromID(b[2]).getBand(b[3]);b=a.getEventSource.getEvent(b[4]);return{band:a,evt:b}};Timeline.EventUtils.encodeEventElID=function(a,b,c,d){return c+"-tl-"+a.timelineID+"-"+b.getIndex()+"-"+d.getID()};Timeline.GregorianDateLabeller=function(a,b){this._locale=a;this._timeZone=b};
Timeline.GregorianDateLabeller.monthNames=[];Timeline.GregorianDateLabeller.dayNames=[];Timeline.GregorianDateLabeller.labelIntervalFunctions=[];Timeline.GregorianDateLabeller.getMonthName=function(a,b){return Timeline.GregorianDateLabeller.monthNames[b][a]};Timeline.GregorianDateLabeller.prototype.labelInterval=function(a,b){var c=Timeline.GregorianDateLabeller.labelIntervalFunctions[this._locale];if(c==null)c=Timeline.GregorianDateLabeller.prototype.defaultLabelInterval;return c.call(this,a,b)};
Timeline.GregorianDateLabeller.prototype.labelPrecise=function(a){return SimileAjax.DateTime.removeTimeZoneOffset(a,this._timeZone).toUTCString()};
Timeline.GregorianDateLabeller.prototype.defaultLabelInterval=function(a,b){var c,d=!1,a=SimileAjax.DateTime.removeTimeZoneOffset(a,this._timeZone);switch(b){case SimileAjax.DateTime.MILLISECOND:c=a.getUTCMilliseconds();break;case SimileAjax.DateTime.SECOND:c=a.getUTCSeconds();break;case SimileAjax.DateTime.MINUTE:c=a.getUTCMinutes();c==0&&(c=a.getUTCHours()+":00",d=!0);break;case SimileAjax.DateTime.HOUR:c=a.getUTCHours()+"hr";break;case SimileAjax.DateTime.DAY:c=Timeline.GregorianDateLabeller.getMonthName(a.getUTCMonth(),
this._locale)+" "+a.getUTCDate();break;case SimileAjax.DateTime.WEEK:c=Timeline.GregorianDateLabeller.getMonthName(a.getUTCMonth(),this._locale)+" "+a.getUTCDate();break;case SimileAjax.DateTime.MONTH:if(c=a.getUTCMonth(),c!=0){c=Timeline.GregorianDateLabeller.getMonthName(c,this._locale);break}case SimileAjax.DateTime.YEAR:case SimileAjax.DateTime.DECADE:case SimileAjax.DateTime.CENTURY:case SimileAjax.DateTime.MILLENNIUM:d=a.getUTCFullYear();c=d>0?a.getUTCFullYear():1-d+"BC";d=b==SimileAjax.DateTime.MONTH||
b==SimileAjax.DateTime.DECADE&&d%100==0||b==SimileAjax.DateTime.CENTURY&&d%1E3==0;break;default:c=a.toUTCString()}return{text:c,emphasized:d}};Timeline.OriginalEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._eventPaintListeners=[];this._frc=this._highlightMatcher=this._filterMatcher=null;this._eventIdToElmt={}};
Timeline.OriginalEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._eventIdToElmt=this._highlightLayer=this._lineLayer=this._eventLayer=this._backLayer=null};Timeline.OriginalEventPainter.prototype.getType=function(){return"original"};Timeline.OriginalEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};
Timeline.OriginalEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.OriginalEventPainter.prototype.addEventPaintListener=function(a){this._eventPaintListeners.push(a)};
Timeline.OriginalEventPainter.prototype.removeEventPaintListener=function(a){for(var b=0;b<this._eventPaintListeners.length;b++)if(this._eventPaintListeners[b]==a){this._eventPaintListeners.splice(b,1);break}};Timeline.OriginalEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.OriginalEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};Timeline.OriginalEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};
Timeline.OriginalEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.OriginalEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(a!=null){this._eventIdToElmt={};this._fireEventPaintListeners("paintStarting",null,null);this._prepareForPainting();for(var b=this._params.theme.event,c=Math.max(b.track.height,b.tape.height+this._frc.getLineHeight()),b={trackOffset:b.track.offset,trackHeight:c,trackGap:b.track.gap,trackIncrement:c+b.track.gap,icon:b.instant.icon,iconWidth:b.instant.iconWidth,iconHeight:b.instant.iconHeight,labelWidth:b.label.width,
maxLabelChar:b.label.maxLabelChar,impreciseIconMargin:b.instant.impreciseIconMargin},d=this._band.getMinDate(),f=this._band.getMaxDate(),c=this._filterMatcher!=null?this._filterMatcher:function(){return!0},g=this._highlightMatcher!=null?this._highlightMatcher:function(){return-1},a=a.getEventReverseIterator(d,f);a.hasNext();)d=a.next(),c(d)&&this.paintEvent(d,b,this._params.theme,g(d));this._highlightLayer.style.display="block";this._lineLayer.style.display="block";this._eventLayer.style.display=
"block";this._band.updateEventTrackInfo(this._tracks.length,b.trackIncrement);this._fireEventPaintListeners("paintEnded",null,null)}};Timeline.OriginalEventPainter.prototype.softPaint=function(){};
Timeline.OriginalEventPainter.prototype._prepareForPainting=function(){var a=this._band;if(this._backLayer==null){this._backLayer=this._band.createLayerDiv(0,"timeline-band-events");this._backLayer.style.visibility="hidden";var b=document.createElement("span");b.className="timeline-event-label";this._backLayer.appendChild(b);this._frc=SimileAjax.Graphics.getFontRenderingContext(b)}this._frc.update();this._tracks=[];this._highlightLayer!=null&&a.removeLayerDiv(this._highlightLayer);this._highlightLayer=
a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";this._lineLayer!=null&&a.removeLayerDiv(this._lineLayer);this._lineLayer=a.createLayerDiv(110,"timeline-band-lines");this._lineLayer.style.display="none";this._eventLayer!=null&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(115,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.OriginalEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.OriginalEventPainter.prototype.paintInstantEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseInstantEvent(a,b,c,d):this.paintPreciseInstantEvent(a,b,c,d)};Timeline.OriginalEventPainter.prototype.paintDurationEvent=function(a,b,c,d){a.isImprecise()?this.paintImpreciseDurationEvent(a,b,c,d):this.paintPreciseDurationEvent(a,b,c,d)};
Timeline.OriginalEventPainter.prototype.paintPreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),g=a.getStart(),g=Math.round(this._band.dateToPixelOffset(g)),e=Math.round(g+b.iconWidth/2),g=Math.round(g-b.iconWidth/2),h=this._getLabelDivClassName(a),i=this._frc.computeSize(f,h),j=e+c.event.label.offsetFromLine,e=this._findFreeTrack(a,j+i.width),l=Math.round(b.trackOffset+e*b.trackIncrement+b.trackHeight/2-i.height/2),k=this._paintEventIcon(a,e,g,b,c,0),f=this._paintEventLabel(a,
f,j,l,i.width,i.height,c,h,d),b=[k.elmt,f.elmt],n=this,h=function(b,c){return n._onClickInstantEvent(k.elmt,c,a)};SimileAjax.DOM.registerEvent(k.elmt,"mousedown",h);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",h);c=this._createHighlightDiv(d,k,c,a);c!=null&&b.push(c);this._fireEventPaintListeners("paintedEvent",a,b);this._eventIdToElmt[a.getID()]=k.elmt;this._tracks[e]=g};
Timeline.OriginalEventPainter.prototype.paintImpreciseInstantEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),g=a.getStart(),e=a.getEnd(),h=Math.round(this._band.dateToPixelOffset(g)),i=Math.round(this._band.dateToPixelOffset(e)),g=Math.round(h+b.iconWidth/2),e=Math.round(h-b.iconWidth/2),j=this._getLabelDivClassName(a),l=this._frc.computeSize(f,j),k=g+c.event.label.offsetFromLine,g=Math.max(k+l.width,i),g=this._findFreeTrack(a,g),n=c.event.tape.height,p=Math.round(b.trackOffset+
g*b.trackIncrement+n),m=this._paintEventIcon(a,g,e,b,c,n),f=this._paintEventLabel(a,f,k,p,l.width,l.height,c,j,d),j=a.getColor(),j=j!=null?j:c.event.instant.impreciseColor,h=this._paintEventTape(a,g,h,i,j,c.event.instant.impreciseOpacity,b,c,0),b=[m.elmt,f.elmt,h.elmt],o=this,i=function(b,c){return o._onClickInstantEvent(m.elmt,c,a)};SimileAjax.DOM.registerEvent(m.elmt,"mousedown",i);SimileAjax.DOM.registerEvent(h.elmt,"mousedown",i);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",i);c=this._createHighlightDiv(d,
m,c,a);c!=null&&b.push(c);this._fireEventPaintListeners("paintedEvent",a,b);this._eventIdToElmt[a.getID()]=m.elmt;this._tracks[g]=e};
Timeline.OriginalEventPainter.prototype.paintPreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),g=a.getStart(),e=a.getEnd(),g=Math.round(this._band.dateToPixelOffset(g)),h=Math.round(this._band.dateToPixelOffset(e)),i=this._getLabelDivClassName(a),j=this._frc.computeSize(f,i),e=Math.max(g+j.width,h),e=this._findFreeTrack(a,e),l=Math.round(b.trackOffset+e*b.trackIncrement+c.event.tape.height),k=a.getColor(),k=k!=null?k:c.event.duration.color,n=this._paintEventTape(a,
e,g,h,k,100,b,c,0),f=this._paintEventLabel(a,f,g,l,j.width,j.height,c,i,d),b=[n.elmt,f.elmt],p=this,h=function(b,c){return p._onClickDurationEvent(n.elmt,c,a)};SimileAjax.DOM.registerEvent(n.elmt,"mousedown",h);SimileAjax.DOM.registerEvent(f.elmt,"mousedown",h);c=this._createHighlightDiv(d,n,c,a);c!=null&&b.push(c);this._fireEventPaintListeners("paintedEvent",a,b);this._eventIdToElmt[a.getID()]=n.elmt;this._tracks[e]=g};
Timeline.OriginalEventPainter.prototype.paintImpreciseDurationEvent=function(a,b,c,d){this._timeline.getDocument();var f=a.getText(),g=a.getStart(),e=a.getLatestStart(),h=a.getEnd(),i=a.getEarliestEnd(),g=Math.round(this._band.dateToPixelOffset(g)),e=Math.round(this._band.dateToPixelOffset(e)),h=Math.round(this._band.dateToPixelOffset(h)),j=Math.round(this._band.dateToPixelOffset(i)),l=this._getLabelDivClassName(a),k=this._frc.computeSize(f,l),i=Math.max(e+k.width,h),i=this._findFreeTrack(a,i),n=
Math.round(b.trackOffset+i*b.trackIncrement+c.event.tape.height),p=a.getColor(),p=p!=null?p:c.event.duration.color,h=this._paintEventTape(a,i,g,h,c.event.duration.impreciseColor,c.event.duration.impreciseOpacity,b,c,0),m=this._paintEventTape(a,i,e,j,p,100,b,c,1),b=this._paintEventLabel(a,f,e,n,k.width,k.height,c,l,d),f=[h.elmt,m.elmt,b.elmt],o=this,e=function(b,c){return o._onClickDurationEvent(m.elmt,c,a)};SimileAjax.DOM.registerEvent(m.elmt,"mousedown",e);SimileAjax.DOM.registerEvent(b.elmt,"mousedown",
e);c=this._createHighlightDiv(d,m,c,a);c!=null&&f.push(c);this._fireEventPaintListeners("paintedEvent",a,f);this._eventIdToElmt[a.getID()]=m.elmt;this._tracks[i]=g};Timeline.OriginalEventPainter.prototype._encodeEventElID=function(a,b){return Timeline.EventUtils.encodeEventElID(this._timeline,this._band,a,b)};Timeline.OriginalEventPainter.prototype._findFreeTrack=function(a,b){var c=a.getTrackNum();if(c!=null)return c;for(c=0;c<this._tracks.length;c++)if(this._tracks[c]>b)break;return c};
Timeline.OriginalEventPainter.prototype._paintEventIcon=function(a,b,c,d,f,g){f=a.getIcon();f=f!=null?f:d.icon;b=g>0?d.trackOffset+b*d.trackIncrement+g+d.impreciseIconMargin:Math.round(d.trackOffset+b*d.trackIncrement+d.trackHeight/2-d.iconHeight/2);g=SimileAjax.Graphics.createTranslucentImage(f);f=this._timeline.getDocument().createElement("div");f.className=this._getElClassName("timeline-event-icon",a,"icon");f.id=this._encodeEventElID("icon",a);f.style.left=c+"px";f.style.top=b+"px";f.appendChild(g);
if(a._title!=null)f.title=a._title;this._eventLayer.appendChild(f);return{left:c,top:b,width:d.iconWidth,height:d.iconHeight,elmt:f}};
Timeline.OriginalEventPainter.prototype._paintEventLabel=function(a,b,c,d,f,g,e,h,i){var j=this._timeline.getDocument().createElement("div");j.className=h;j.id=this._encodeEventElID("label",a);j.style.left=c+"px";j.style.width=f+"px";j.style.top=d+"px";j.innerHTML=b;if(a._title!=null)j.title=a._title;b=a.getTextColor();b==null&&(b=a.getColor());if(b!=null)j.style.color=b;if(e.event.highlightLabelBackground&&i>=0)j.style.background=this._getHighlightColor(i,e);this._eventLayer.appendChild(j);return{left:c,
top:d,width:f,height:g,elmt:j}};
Timeline.OriginalEventPainter.prototype._paintEventTape=function(a,b,c,d,f,g,e,h,i){d-=c;h=h.event.tape.height;b=e.trackOffset+b*e.trackIncrement;e=this._timeline.getDocument().createElement("div");e.className=this._getElClassName("timeline-event-tape",a,"tape");e.id=this._encodeEventElID("tape"+i,a);e.style.left=c+"px";e.style.width=d+"px";e.style.height=h+"px";e.style.top=b+"px";if(a._title!=null)e.title=a._title;if(f!=null)e.style.backgroundColor=f;f=a.getTapeImage();a=a.getTapeRepeat();a=a!=null?
a:"repeat";if(f!=null)e.style.backgroundImage="url("+f+")",e.style.backgroundRepeat=a;SimileAjax.Graphics.setOpacity(e,g);this._eventLayer.appendChild(e);return{left:c,top:b,width:d,height:h,elmt:e}};Timeline.OriginalEventPainter.prototype._getLabelDivClassName=function(a){return this._getElClassName("timeline-event-label",a,"label")};Timeline.OriginalEventPainter.prototype._getElClassName=function(a,b,c){var b=b.getClassName(),d=[];b&&(c&&d.push(c+"-"+b+" "),d.push(b+" "));d.push(a);return d.join("")};
Timeline.OriginalEventPainter.prototype._getHighlightColor=function(a,b){var c=b.event.highlightColors;return c[Math.min(a,c.length-1)]};
Timeline.OriginalEventPainter.prototype._createHighlightDiv=function(a,b,c,d){var f=null;if(a>=0)f=this._timeline.getDocument(),a=this._getHighlightColor(a,c),f=f.createElement("div"),f.className=this._getElClassName("timeline-event-highlight",d,"highlight"),f.id=this._encodeEventElID("highlight0",d),f.style.position="absolute",f.style.overflow="hidden",f.style.left=b.left-2+"px",f.style.width=b.width+4+"px",f.style.top=b.top-2+"px",f.style.height=b.height+4+"px",f.style.background=a,this._highlightLayer.appendChild(f);
return f};Timeline.OriginalEventPainter.prototype._onClickInstantEvent=function(a,b,c){var d=SimileAjax.DOM.getPageCoordinates(a);this._showBubble(d.left+Math.ceil(a.offsetWidth/2),d.top+Math.ceil(a.offsetHeight/2),c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.OriginalEventPainter.prototype._onClickDurationEvent=function(a,b,c){if("pageX"in b)var a=b.pageX,d=b.pageY;else d=SimileAjax.DOM.getPageCoordinates(a),a=b.offsetX+d.left,d=b.offsetY+d.top;this._showBubble(a,d,c);this._fireOnSelect(c.getID());b.cancelBubble=!0;SimileAjax.DOM.cancelEvent(b);return!1};
Timeline.OriginalEventPainter.prototype.showBubble=function(a){var b=this._eventIdToElmt[a.getID()];if(b){var c=SimileAjax.DOM.getPageCoordinates(b);this._showBubble(c.left+b.offsetWidth/2,c.top+b.offsetHeight/2,a)}};
Timeline.OriginalEventPainter.prototype._showBubble=function(a,b,c){var d=document.createElement("div"),f=this._params.theme.event.bubble;c.fillInfoBubble(d,this._params.theme,this._band.getLabeller());SimileAjax.WindowManager.cancelPopups();SimileAjax.Graphics.createBubbleForContentAndPoint(d,a,b,f.width,null,f.maxHeight)};Timeline.OriginalEventPainter.prototype._fireOnSelect=function(a){for(var b=0;b<this._onSelectListeners.length;b++)this._onSelectListeners[b](a)};
Timeline.OriginalEventPainter.prototype._fireEventPaintListeners=function(a,b,c){for(var d=0;d<this._eventPaintListeners.length;d++)this._eventPaintListeners[d](this._band,a,b,c)};Timeline.OverviewEventPainter=function(a){this._params=a;this._onSelectListeners=[];this._highlightMatcher=this._filterMatcher=null};Timeline.OverviewEventPainter.prototype.initialize=function(a,b){this._band=a;this._timeline=b;this._highlightLayer=this._eventLayer=null};Timeline.OverviewEventPainter.prototype.getType=function(){return"overview"};
Timeline.OverviewEventPainter.prototype.addOnSelectListener=function(a){this._onSelectListeners.push(a)};Timeline.OverviewEventPainter.prototype.removeOnSelectListener=function(a){for(var b=0;b<this._onSelectListeners.length;b++)if(this._onSelectListeners[b]==a){this._onSelectListeners.splice(b,1);break}};Timeline.OverviewEventPainter.prototype.getFilterMatcher=function(){return this._filterMatcher};Timeline.OverviewEventPainter.prototype.setFilterMatcher=function(a){this._filterMatcher=a};
Timeline.OverviewEventPainter.prototype.getHighlightMatcher=function(){return this._highlightMatcher};Timeline.OverviewEventPainter.prototype.setHighlightMatcher=function(a){this._highlightMatcher=a};
Timeline.OverviewEventPainter.prototype.paint=function(){var a=this._band.getEventSource();if(a!=null){this._prepareForPainting();for(var b=this._params.theme.event,b={trackOffset:b.overviewTrack.offset,trackHeight:b.overviewTrack.height,trackGap:b.overviewTrack.gap,trackIncrement:b.overviewTrack.height+b.overviewTrack.gap},c=this._band.getMinDate(),d=this._band.getMaxDate(),f=this._filterMatcher!=null?this._filterMatcher:function(){return!0},g=this._highlightMatcher!=null?this._highlightMatcher:
function(){return-1},a=a.getEventReverseIterator(c,d);a.hasNext();)c=a.next(),f(c)&&this.paintEvent(c,b,this._params.theme,g(c));this._highlightLayer.style.display="block";this._eventLayer.style.display="block";this._band.updateEventTrackInfo(this._tracks.length,b.trackIncrement)}};Timeline.OverviewEventPainter.prototype.softPaint=function(){};
Timeline.OverviewEventPainter.prototype._prepareForPainting=function(){var a=this._band;this._tracks=[];this._highlightLayer!=null&&a.removeLayerDiv(this._highlightLayer);this._highlightLayer=a.createLayerDiv(105,"timeline-band-highlights");this._highlightLayer.style.display="none";this._eventLayer!=null&&a.removeLayerDiv(this._eventLayer);this._eventLayer=a.createLayerDiv(110,"timeline-band-events");this._eventLayer.style.display="none"};
Timeline.OverviewEventPainter.prototype.paintEvent=function(a,b,c,d){a.isInstant()?this.paintInstantEvent(a,b,c,d):this.paintDurationEvent(a,b,c,d)};Timeline.OverviewEventPainter.prototype.paintInstantEvent=function(a,b,c,d){var f=a.getStart(),f=Math.round(this._band.dateToPixelOffset(f)),g=a.getColor(),g=a.getClassName()?null:g!=null?g:c.event.duration.color,a=this._paintEventTick(a,f,g,100,b,c);this._createHighlightDiv(d,a,c)};
Timeline.OverviewEventPainter.prototype.paintDurationEvent=function(a,b,c,d){for(var f=a.getLatestStart(),g=a.getEarliestEnd(),f=Math.round(this._band.dateToPixelOffset(f)),g=Math.round(this._band.dateToPixelOffset(g)),e=0;e<this._tracks.length;e++)if(g<this._tracks[e])break;this._tracks[e]=g;var h=a.getColor(),i=a.getClassName(),h=i?null:h!=null?h:c.event.duration.color,a=this._paintEventTape(a,e,f,g,h,100,b,c,i);this._createHighlightDiv(d,a,c)};
Timeline.OverviewEventPainter.prototype._paintEventTape=function(a,b,c,d,f,g,e,h,i){a=e.trackOffset+b*e.trackIncrement;d-=c;e=e.trackHeight;b=this._timeline.getDocument().createElement("div");b.className="timeline-small-event-tape";i&&(b.className+=" small-"+i);b.style.left=c+"px";b.style.width=d+"px";b.style.top=a+"px";b.style.height=e+"px";if(f)b.style.backgroundColor=f;g<100&&SimileAjax.Graphics.setOpacity(b,g);this._eventLayer.appendChild(b);return{left:c,top:a,width:d,height:e,elmt:b}};
Timeline.OverviewEventPainter.prototype._paintEventTick=function(a,b,c,d,f,g){c=g.event.overviewTrack.tickHeight;f=f.trackOffset-c;g=this._timeline.getDocument().createElement("div");g.className="timeline-small-event-icon";g.style.left=b+"px";g.style.top=f+"px";(a=a.getClassName())&&(g.className+=" small-"+a);d<100&&SimileAjax.Graphics.setOpacity(g,d);this._eventLayer.appendChild(g);return{left:b,top:f,width:1,height:c,elmt:g}};
Timeline.OverviewEventPainter.prototype._createHighlightDiv=function(a,b,c){if(a>=0){var d=this._timeline.getDocument(),c=c.event,a=c.highlightColors[Math.min(a,c.highlightColors.length-1)],d=d.createElement("div");d.style.position="absolute";d.style.overflow="hidden";d.style.left=b.left-1+"px";d.style.width=b.width+2+"px";d.style.top=b.top-1+"px";d.style.height=b.height+2+"px";d.style.background=a;this._highlightLayer.appendChild(d)}};Timeline.OverviewEventPainter.prototype.showBubble=function(){};
Timeline.DefaultEventSource=function(a){this._events=a instanceof Object?a:new SimileAjax.EventIndex;this._listeners=[]};Timeline.DefaultEventSource.prototype.addListener=function(a){this._listeners.push(a)};Timeline.DefaultEventSource.prototype.removeListener=function(a){for(var b=0;b<this._listeners.length;b++)if(this._listeners[b]==a){this._listeners.splice(b,1);break}};
Timeline.DefaultEventSource.prototype.loadXML=function(a,b){for(var c=this._getBaseURL(b),d=a.documentElement.getAttribute("wiki-url"),f=a.documentElement.getAttribute("wiki-section"),g=a.documentElement.getAttribute("date-time-format"),g=this._events.getUnit().getParser(g),e=a.documentElement.firstChild,h=!1;e!=null;){if(e.nodeType==1){h="";if(e.firstChild!=null&&e.firstChild.nodeType==3)h=e.firstChild.nodeValue;var i=e.getAttribute("isDuration")===null&&e.getAttribute("durationEvent")===null||e.getAttribute("isDuration")==
"false"||e.getAttribute("durationEvent")=="false",h=new Timeline.DefaultEventSource.Event({id:e.getAttribute("id"),start:g(e.getAttribute("start")),end:g(e.getAttribute("end")),latestStart:g(e.getAttribute("latestStart")),earliestEnd:g(e.getAttribute("earliestEnd")),instant:i,text:e.getAttribute("title"),description:h,image:this._resolveRelativeURL(e.getAttribute("image"),c),link:this._resolveRelativeURL(e.getAttribute("link"),c),icon:this._resolveRelativeURL(e.getAttribute("icon"),c),color:e.getAttribute("color"),
textColor:e.getAttribute("textColor"),hoverText:e.getAttribute("hoverText"),classname:e.getAttribute("classname"),tapeImage:e.getAttribute("tapeImage"),tapeRepeat:e.getAttribute("tapeRepeat"),caption:e.getAttribute("caption"),eventID:e.getAttribute("eventID"),trackNum:e.getAttribute("trackNum")});h._node=e;h.getProperty=function(a){return this._node.getAttribute(a)};h.setWikiInfo(d,f);this._events.add(h);h=!0}e=e.nextSibling}h&&this._fire("onAddMany",[])};
Timeline.DefaultEventSource.prototype.loadJSON=function(a,b){var c=this._getBaseURL(b),d=!1;if(a&&a.events){var f="wikiURL"in a?a.wikiURL:null,g="wikiSection"in a?a.wikiSection:null,e="dateTimeFormat"in a?a.dateTimeFormat:null,e=this._events.getUnit().getParser(e),h=0;for(;h<a.events.length;h++){var d=a.events[h],i=d.isDuration||d.durationEvent!=null&&!d.durationEvent,i=new Timeline.DefaultEventSource.Event({id:"id"in d?d.id:void 0,start:e(d.start),end:e(d.end),latestStart:e(d.latestStart),earliestEnd:e(d.earliestEnd),
instant:i,text:d.title,description:d.description,image:this._resolveRelativeURL(d.image,c),link:this._resolveRelativeURL(d.link,c),icon:this._resolveRelativeURL(d.icon,c),color:d.color,textColor:d.textColor,hoverText:d.hoverText,classname:d.classname,tapeImage:d.tapeImage,tapeRepeat:d.tapeRepeat,caption:d.caption,eventID:d.eventID,trackNum:d.trackNum});i._obj=d;i.getProperty=function(a){return this._obj[a]};i.setWikiInfo(f,g);this._events.add(i);d=!0}}d&&this._fire("onAddMany",[])};
Timeline.DefaultEventSource.prototype.loadSPARQL=function(a,b){var c=this._getBaseURL(b),d=this._events.getUnit().getParser("iso8601");if(a!=null){for(var f=a.documentElement.firstChild;f!=null&&(f.nodeType!=1||f.nodeName!="results");)f=f.nextSibling;var g=null,e=null;if(f!=null)g=f.getAttribute("wiki-url"),e=f.getAttribute("wiki-section"),f=f.firstChild;for(var h=!1;f!=null;){if(f.nodeType==1){for(var h={},i=f.firstChild;i!=null;){if(i.nodeType==1&&i.firstChild!=null&&i.firstChild.nodeType==1&&i.firstChild.firstChild!=
null&&i.firstChild.firstChild.nodeType==3)h[i.getAttribute("name")]=i.firstChild.firstChild.nodeValue;i=i.nextSibling}h.start==null&&h.date!=null&&(h.start=h.date);i=h.isDuration===null&&h.durationEvent===null||h.isDuration=="false"||h.durationEvent=="false";i=new Timeline.DefaultEventSource.Event({id:h.id,start:d(h.start),end:d(h.end),latestStart:d(h.latestStart),earliestEnd:d(h.earliestEnd),instant:i,text:h.title,description:h.description,image:this._resolveRelativeURL(h.image,c),link:this._resolveRelativeURL(h.link,
c),icon:this._resolveRelativeURL(h.icon,c),color:h.color,textColor:h.textColor,hoverText:h.hoverText,caption:h.caption,classname:h.classname,tapeImage:h.tapeImage,tapeRepeat:h.tapeRepeat,eventID:h.eventID,trackNum:h.trackNum});i._bindings=h;i.getProperty=function(a){return this._bindings[a]};i.setWikiInfo(g,e);this._events.add(i);h=!0}f=f.nextSibling}h&&this._fire("onAddMany",[])}};Timeline.DefaultEventSource.prototype.add=function(a){this._events.add(a);this._fire("onAddOne",[a])};
Timeline.DefaultEventSource.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this._events.add(a[b]);this._fire("onAddMany",[])};Timeline.DefaultEventSource.prototype.clear=function(){this._events.removeAll();this._fire("onClear",[])};Timeline.DefaultEventSource.prototype.getEvent=function(a){return this._events.getEvent(a)};Timeline.DefaultEventSource.prototype.getEventIterator=function(a,b){return this._events.getIterator(a,b)};
Timeline.DefaultEventSource.prototype.getEventReverseIterator=function(a,b){return this._events.getReverseIterator(a,b)};Timeline.DefaultEventSource.prototype.getAllEventIterator=function(){return this._events.getAllIterator()};Timeline.DefaultEventSource.prototype.getCount=function(){return this._events.getCount()};Timeline.DefaultEventSource.prototype.getEarliestDate=function(){return this._events.getEarliestDate()};Timeline.DefaultEventSource.prototype.getLatestDate=function(){return this._events.getLatestDate()};
Timeline.DefaultEventSource.prototype._fire=function(a,b){for(var c=0;c<this._listeners.length;c++){var d=this._listeners[c];if(a in d)try{d[a].apply(d,b)}catch(f){SimileAjax.Debug.exception(f)}}};Timeline.DefaultEventSource.prototype._getBaseURL=function(a){if(a.indexOf("://")<0)var b=this._getBaseURL(document.location.href),a=a.substr(0,1)=="/"?b.substr(0,b.indexOf("/",b.indexOf("://")+3))+a:b+a;b=a.lastIndexOf("/");return b<0?"":a.substr(0,b+1)};
Timeline.DefaultEventSource.prototype._resolveRelativeURL=function(a,b){return a==null||a==""?a:a.indexOf("://")>0?a:a.substr(0,1)=="/"?b.substr(0,b.indexOf("/",b.indexOf("://")+3))+a:b+a};
Timeline.DefaultEventSource.Event=function(a){function b(b){return a[b]!=null&&a[b]!=""?a[b]:null}var c=a.id?a.id.trim():"";this._id=c.length>0?c:Timeline.EventUtils.getNewEventID();this._instant=a.instant||a.end==null;this._start=a.start;this._end=a.end!=null?a.end:a.start;this._latestStart=a.latestStart!=null?a.latestStart:a.instant?this._end:this._start;this._earliestEnd=a.earliestEnd!=null?a.earliestEnd:this._end;c=[];if(this._start>this._latestStart)this._latestStart=this._start,c.push("start is > latestStart");
if(this._start>this._earliestEnd)this._earliestEnd=this._latestStart,c.push("start is > earliestEnd");if(this._start>this._end)this._end=this._earliestEnd,c.push("start is > end");if(this._latestStart>this._earliestEnd)this._earliestEnd=this._latestStart,c.push("latestStart is > earliestEnd");if(this._latestStart>this._end)this._end=this._earliestEnd,c.push("latestStart is > end");if(this._earliestEnd>this._end)this._end=this._earliestEnd,c.push("earliestEnd is > end");this._eventID=b("eventID");
this._text=a.text!=null?SimileAjax.HTML.deEntify(a.text):"";c.length>0&&(this._text+=" PROBLEM: "+c.join(", "));this._description=SimileAjax.HTML.deEntify(a.description);this._image=b("image");this._link=b("link");this._title=b("hoverText");this._title=b("caption");this._icon=b("icon");this._color=b("color");this._textColor=b("textColor");this._classname=b("classname");this._tapeImage=b("tapeImage");this._tapeRepeat=b("tapeRepeat");this._trackNum=b("trackNum");if(this._trackNum!=null)this._trackNum=
parseInt(this._trackNum);this._wikiSection=this._wikiURL=null};
Timeline.DefaultEventSource.Event.prototype={getID:function(){return this._id},isInstant:function(){return this._instant},isImprecise:function(){return this._start!=this._latestStart||this._end!=this._earliestEnd},getStart:function(){return this._start},getEnd:function(){return this._end},getLatestStart:function(){return this._latestStart},getEarliestEnd:function(){return this._earliestEnd},getEventID:function(){return this._eventID},getText:function(){return this._text},getDescription:function(){return this._description},
getImage:function(){return this._image},getLink:function(){return this._link},getIcon:function(){return this._icon},getColor:function(){return this._color},getTextColor:function(){return this._textColor},getClassName:function(){return this._classname},getTapeImage:function(){return this._tapeImage},getTapeRepeat:function(){return this._tapeRepeat},getTrackNum:function(){return this._trackNum},getProperty:function(){return null},getWikiURL:function(){return this._wikiURL},getWikiSection:function(){return this._wikiSection},
setWikiInfo:function(a,b){this._wikiURL=a;this._wikiSection=b},fillDescription:function(a){a.innerHTML=this._description},fillWikiInfo:function(a){a.style.display="none";if(!(this._wikiURL==null||this._wikiSection==null)){var b=this.getProperty("wikiID");if(b==null||b.length==0)b=this.getText();if(!(b==null||b.length==0)){a.style.display="inline";var b=b.replace(/\s/g,"_"),b=this._wikiURL+this._wikiSection.replace(/\s/g,"_")+"/"+b,c=document.createElement("a");c.href=b;c.target="new";c.innerHTML=
Timeline.strings[Timeline.clientLocale].wikiLinkLabel;a.appendChild(document.createTextNode("["));a.appendChild(c);a.appendChild(document.createTextNode("]"))}}},fillTime:function(a,b){this._instant?this.isImprecise()?(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end)))):a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))):this.isImprecise()?
(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start)+" ~ "+b.labelPrecise(this._latestStart))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._earliestEnd)+" ~ "+b.labelPrecise(this._end)))):(a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._start))),a.appendChild(a.ownerDocument.createElement("br")),a.appendChild(a.ownerDocument.createTextNode(b.labelPrecise(this._end))))},fillInfoBubble:function(a,
b,c){var d=a.ownerDocument,f=this.getText(),g=this.getLink(),e=this.getImage();if(e!=null){var h=d.createElement("img");h.src=e;b.event.bubble.imageStyler(h);a.appendChild(h)}e=d.createElement("div");f=d.createTextNode(f);g!=null?(h=d.createElement("a"),h.href=g,h.appendChild(f),e.appendChild(h)):e.appendChild(f);b.event.bubble.titleStyler(e);a.appendChild(e);g=d.createElement("div");this.fillDescription(g);b.event.bubble.bodyStyler(g);a.appendChild(g);g=d.createElement("div");this.fillTime(g,c);
b.event.bubble.timeStyler(g);a.appendChild(g);c=d.createElement("div");this.fillWikiInfo(c);b.event.bubble.wikiStyler(c);a.appendChild(c)}};Timeline.ClassicTheme={};Timeline.ClassicTheme.implementations=[];Timeline.ClassicTheme.create=function(a){a==null&&(a=Timeline.getDefaultLocale());a=Timeline.ClassicTheme.implementations[a];if(a==null)a=Timeline.ClassicTheme._Impl;return new a};
Timeline.ClassicTheme._Impl=function(){this.firstDayOfWeek=0;this.autoWidth=!1;this.autoWidthAnimationTime=500;this.timeline_stop=this.timeline_start=null;this.ether={backgroundColors:[],highlightOpacity:50,interval:{line:{show:!0,opacity:25},weekend:{opacity:30},marker:{hAlign:"Bottom",vAlign:"Right"}}};this.event={track:{height:10,gap:2,offset:2,autoWidthMargin:1.5},overviewTrack:{offset:20,tickHeight:6,height:2,gap:1,autoWidthMargin:5},tape:{height:4},instant:{icon:Timeline.urlPrefix+"images/dull-blue-circle.png",
iconWidth:10,iconHeight:10,impreciseOpacity:20,impreciseIconMargin:3},duration:{impreciseOpacity:20},label:{backgroundOpacity:50,offsetFromLine:3},highlightColors:["#FFFF00","#FFC000","#FF0000","#0000FF"],highlightLabelBackground:!1,bubble:{width:250,maxHeight:0,titleStyler:function(a){a.className="timeline-event-bubble-title"},bodyStyler:function(a){a.className="timeline-event-bubble-body"},imageStyler:function(a){a.className="timeline-event-bubble-image"},wikiStyler:function(a){a.className="timeline-event-bubble-wiki"},
timeStyler:function(a){a.className="timeline-event-bubble-time"}}};this.mouseWheel="scroll"};Timeline.version="2.3.0";Timeline.ajax_lib_version=SimileAjax.version;Timeline.display_version=Timeline.version+" (with Ajax lib "+Timeline.ajax_lib_version+")";Timeline.strings={};Timeline.HORIZONTAL=0;Timeline.VERTICAL=1;Timeline._defaultTheme=null;Timeline.getDefaultLocale=function(){return Timeline.clientLocale};
Timeline.create=function(a,b,c,d){if(Timeline.timelines==null)Timeline.timelines=[];var f=Timeline.timelines.length;Timeline.timelines[f]=null;a=new Timeline._Impl(a,b,c,d,f);return Timeline.timelines[f]=a};
Timeline.createBandInfo=function(a){var b="theme"in a?a.theme:Timeline.getDefaultTheme(),c="eventSource"in a?a.eventSource:null,d=new Timeline.LinearEther({centersOn:"date"in a?a.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[a.intervalUnit],pixelsPerInterval:a.intervalPixels,theme:b}),f=new Timeline.GregorianEtherPainter({unit:a.intervalUnit,multiple:"multiple"in a?a.multiple:1,theme:b,align:"align"in a?a.align:void 0}),g={showText:"showEventText"in a?a.showEventText:!0,theme:b};
if("eventPainterParams"in a)for(var e in a.eventPainterParams)g[e]=a.eventPainterParams[e];if("trackHeight"in a)g.trackHeight=a.trackHeight;if("trackGap"in a)g.trackGap=a.trackGap;e="overview"in a&&a.overview?"overview":"layout"in a?a.layout:"original";if("eventPainter"in a)g=new a.eventPainter(g);else switch(e){case "overview":g=new Timeline.OverviewEventPainter(g);break;case "detailed":g=new Timeline.DetailedEventPainter(g);break;default:g=new Timeline.OriginalEventPainter(g)}return{width:a.width,
eventSource:c,timeZone:"timeZone"in a?a.timeZone:0,ether:d,etherPainter:f,eventPainter:g,theme:b,zoomIndex:"zoomIndex"in a?a.zoomIndex:0,zoomSteps:"zoomSteps"in a?a.zoomSteps:null}};
Timeline.createHotZoneBandInfo=function(a){var b="theme"in a?a.theme:Timeline.getDefaultTheme(),c="eventSource"in a?a.eventSource:null,d=new Timeline.HotZoneEther({centersOn:"date"in a?a.date:new Date,interval:SimileAjax.DateTime.gregorianUnitLengths[a.intervalUnit],pixelsPerInterval:a.intervalPixels,zones:a.zones,theme:b}),f=new Timeline.HotZoneGregorianEtherPainter({unit:a.intervalUnit,zones:a.zones,theme:b,align:"align"in a?a.align:void 0}),g={showText:"showEventText"in a?a.showEventText:!0,theme:b};
if("eventPainterParams"in a)for(var e in a.eventPainterParams)g[e]=a.eventPainterParams[e];if("trackHeight"in a)g.trackHeight=a.trackHeight;if("trackGap"in a)g.trackGap=a.trackGap;e="overview"in a&&a.overview?"overview":"layout"in a?a.layout:"original";if("eventPainter"in a)g=new a.eventPainter(g);else switch(e){case "overview":g=new Timeline.OverviewEventPainter(g);break;case "detailed":g=new Timeline.DetailedEventPainter(g);break;default:g=new Timeline.OriginalEventPainter(g)}return{width:a.width,
eventSource:c,timeZone:"timeZone"in a?a.timeZone:0,ether:d,etherPainter:f,eventPainter:g,theme:b,zoomIndex:"zoomIndex"in a?a.zoomIndex:0,zoomSteps:"zoomSteps"in a?a.zoomSteps:null}};Timeline.getDefaultTheme=function(){if(Timeline._defaultTheme==null)Timeline._defaultTheme=Timeline.ClassicTheme.create(Timeline.getDefaultLocale());return Timeline._defaultTheme};Timeline.setDefaultTheme=function(a){Timeline._defaultTheme=a};
Timeline.loadXML=function(a,b){SimileAjax.XmlHttp.get(a,function(b){alert("Failed to load data xml from "+a+"\n"+b)},function(c){var d=c.responseXML;!d.documentElement&&c.responseStream&&d.load(c.responseStream);b(d,a)})};Timeline.loadJSON=function(a,b){SimileAjax.XmlHttp.get(a,function(b){alert("Failed to load json data from "+a+"\n"+b)},function(c){b(eval("("+c.responseText+")"),a)})};Timeline.getTimelineFromID=function(a){return Timeline.timelines[a]};
Timeline.writeVersion=function(a){document.getElementById(a).innerHTML=this.display_version};
Timeline._Impl=function(a,b,c,d,f){SimileAjax.WindowManager.initialize();this._containerDiv=a;this._bandInfos=b;this._orientation=c==null?Timeline.HORIZONTAL:c;this._unit=d!=null?d:SimileAjax.NativeDateUnit;this._starting=!0;this._autoResizing=!1;this.autoWidth=b&&b[0]&&b[0].theme&&b[0].theme.autoWidth;this.autoWidthAnimationTime=b&&b[0]&&b[0].theme&&b[0].theme.autoWidthAnimationTime;this.timelineID=f;this.timeline_start=b&&b[0]&&b[0].theme&&b[0].theme.timeline_start;this.timeline_stop=b&&b[0]&&b[0].theme&&
b[0].theme.timeline_stop;this.timeline_at_stop=this.timeline_at_start=!1;this._initialize()};Timeline._Impl.prototype.dispose=function(){for(var a=0;a<this._bands.length;a++)this._bands[a].dispose();this._bandInfos=this._bands=null;this._containerDiv.innerHTML="";Timeline.timelines[this.timelineID]=null};Timeline._Impl.prototype.getBandCount=function(){return this._bands.length};Timeline._Impl.prototype.getBand=function(a){return this._bands[a]};
Timeline._Impl.prototype.finishedEventLoading=function(){this._autoWidthCheck(!0);this._starting=!1};Timeline._Impl.prototype.layout=function(){this._autoWidthCheck(!0);this._distributeWidths()};Timeline._Impl.prototype.paint=function(){for(var a=0;a<this._bands.length;a++)this._bands[a].paint()};Timeline._Impl.prototype.getDocument=function(){return this._containerDiv.ownerDocument};Timeline._Impl.prototype.addDiv=function(a){this._containerDiv.appendChild(a)};
Timeline._Impl.prototype.removeDiv=function(a){this._containerDiv.removeChild(a)};Timeline._Impl.prototype.isHorizontal=function(){return this._orientation==Timeline.HORIZONTAL};Timeline._Impl.prototype.isVertical=function(){return this._orientation==Timeline.VERTICAL};Timeline._Impl.prototype.getPixelLength=function(){return this._orientation==Timeline.HORIZONTAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight};
Timeline._Impl.prototype.getPixelWidth=function(){return this._orientation==Timeline.VERTICAL?this._containerDiv.offsetWidth:this._containerDiv.offsetHeight};Timeline._Impl.prototype.getUnit=function(){return this._unit};Timeline._Impl.prototype.getWidthStyle=function(){return this._orientation==Timeline.HORIZONTAL?"height":"width"};
Timeline._Impl.prototype.loadXML=function(a,b){var c=this,d=function(b){alert("Failed to load data xml from "+a+"\n"+b);c.hideLoadingMessage()},f=function(d){try{var e=d.responseXML;!e.documentElement&&d.responseStream&&e.load(d.responseStream);b(e,a)}finally{c.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(a,d,f)},0)};
Timeline._Impl.prototype.loadJSON=function(a,b){var c=this,d=function(b){alert("Failed to load json data from "+a+"\n"+b);c.hideLoadingMessage()},f=function(d){try{b(eval("("+d.responseText+")"),a)}finally{c.hideLoadingMessage()}};this.showLoadingMessage();window.setTimeout(function(){SimileAjax.XmlHttp.get(a,d,f)},0)};Timeline._Impl.prototype._autoWidthScrollListener=function(a){a.getTimeline()._autoWidthCheck(!1)};
Timeline._Impl.prototype._autoWidthCheck=function(a){function b(){var a=c.getWidthStyle();if(d)c._containerDiv.style[a]=f+"px";else{c._autoResizing=!0;var b={};b[a]=f+"px";SimileAjax.jQuery(c._containerDiv).animate(b,c.autoWidthAnimationTime,"linear",function(){c._autoResizing=!1})}}var c=this,d=c._starting,f=0;c.autoWidth&&function(){var d=0,e=c.getPixelWidth();if(!c._autoResizing){for(var h=0;h<c._bands.length;h++)c._bands[h].checkAutoWidth(),d+=c._bandInfos[h].width;if(d>e||a)f=d,b(),c._distributeWidths()}}()};
Timeline._Impl.prototype._initialize=function(){var a=this._containerDiv,b=a.ownerDocument;a.className=a.className.split(" ").concat("timeline-container").join(" ");var c=this.isHorizontal()?"horizontal":"vertical";for(a.className+=" timeline-"+c;a.firstChild;)a.removeChild(a.firstChild);c=SimileAjax.Graphics.createTranslucentImage(Timeline.urlPrefix+(this.isHorizontal()?"images/copyright-vertical.png":"images/copyright.png"));c.className="timeline-copyright";c.title="Timeline copyright SIMILE - www.code.google.com/p/simile-widgets/";
SimileAjax.DOM.registerEvent(c,"click",function(){window.location="http://code.google.com/p/simile-widgets/"});a.appendChild(c);this._bands=[];for(c=0;c<this._bandInfos.length;c++)this._bands.push(new Timeline._Band(this,this._bandInfos[c],c));this._distributeWidths();for(c=0;c<this._bandInfos.length;c++){var d=this._bandInfos[c];"syncWith"in d&&this._bands[c].setSyncWithBand(this._bands[d.syncWith],"highlight"in d?d.highlight:!1)}if(this.autoWidth)for(c=0;c<this._bands.length;c++)this._bands[c].addOnScrollListener(this._autoWidthScrollListener);
var f=SimileAjax.Graphics.createMessageBubble(b);f.containerDiv.className="timeline-message-container";a.appendChild(f.containerDiv);f.contentDiv.className="timeline-message";f.contentDiv.innerHTML="<img src='"+Timeline.urlPrefix+"images/progress-running.gif' /> Loading...";this.showLoadingMessage=function(){f.containerDiv.style.display="block"};this.hideLoadingMessage=function(){f.containerDiv.style.display="none"}};
Timeline._Impl.prototype._distributeWidths=function(){for(var a=this.getPixelLength(),b=this.getPixelWidth(),c=0,d=0;d<this._bands.length;d++){var f=this._bands[d],g=this._bandInfos[d].width;if(typeof g=="string"){var e=g.indexOf("%");e>0?(g=parseInt(g.substr(0,e)),g=Math.round(g*b/100)):g=parseInt(g)}f.setBandShiftAndWidth(c,g);f.setViewLength(a);c+=g}};
Timeline._Impl.prototype.shiftOK=function(a,b){var c=b>0,d=b<0;if(c&&this.timeline_start==null||d&&this.timeline_stop==null||b==0)return!0;for(var f=!1,g=0;g<this._bands.length&&!f;g++)f=this._bands[g].busy();if(f)return!0;if(c&&this.timeline_at_start||d&&this.timeline_at_stop)return!1;d=!1;for(g=0;g<this._bands.length&&!d;g++)d=this._bands[g],d=c?(g==a?d.getMinVisibleDateAfterDelta(b):d.getMinVisibleDate())>=this.timeline_start:(g==a?d.getMaxVisibleDateAfterDelta(b):d.getMaxVisibleDate())<=this.timeline_stop;
c?(this.timeline_at_start=!d,this.timeline_at_stop=!1):(this.timeline_at_stop=!d,this.timeline_at_start=!1);return d};Timeline._Impl.prototype.zoom=function(a,b,c,d){var f=null,g=/^timeline-band-([0-9]+)$/.exec(d.id);g&&(f=parseInt(g[1]));f!=null&&this._bands[f].zoom(a,b,c,d);this.paint()};Timeline.NativeDateUnit={};Timeline.NativeDateUnit.createLabeller=function(a,b){return new Timeline.GregorianDateLabeller(a,b)};Timeline.NativeDateUnit.makeDefaultValue=function(){return new Date};
Timeline.NativeDateUnit.cloneValue=function(a){return new Date(a.getTime())};Timeline.NativeDateUnit.getParser=function(a){typeof a=="string"&&(a=a.toLowerCase());return a=="iso8601"||a=="iso 8601"?Timeline.DateTime.parseIso8601DateTime:Timeline.DateTime.parseGregorianDateTime};Timeline.NativeDateUnit.parseFromObject=function(a){return Timeline.DateTime.parseGregorianDateTime(a)};Timeline.NativeDateUnit.toNumber=function(a){return a.getTime()};Timeline.NativeDateUnit.fromNumber=function(a){return new Date(a)};
Timeline.NativeDateUnit.compare=function(a,b){var c,d;c=typeof a=="object"?a.getTime():Number(a);d=typeof b=="object"?b.getTime():Number(b);return c-d};Timeline.NativeDateUnit.earlier=function(a,b){return Timeline.NativeDateUnit.compare(a,b)<0?a:b};Timeline.NativeDateUnit.later=function(a,b){return Timeline.NativeDateUnit.compare(a,b)>0?a:b};Timeline.NativeDateUnit.change=function(a,b){return new Date(a.getTime()+b)};
